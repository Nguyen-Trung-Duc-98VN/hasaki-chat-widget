{"version":3,"sources":["reducer/ChatWidget/types.js","web.config.js","utils/request.js","apis/chat.js","reducer/Janus/types.js","utils/Janus/janus.js","utils/Janus/chatroom.js","reducer/ChatWidget/actions.js","components/ChatWidget/components/AddMsgReply.jsx","components/ChatWidget/components/AddMsgBox.jsx","components/ChatWidget/components/ChatTabSearchBar.jsx","components/ChatWidget/components/ChatTabGroupTitle.jsx","components/ChatWidget/components/PostReply.jsx","images/hasaki-logo.png","components/ChatWidget/components/PostSent.jsx","components/ChatWidget/components/Posts.jsx","utils/useElementOnScreen.js","components/ChatWidget/components/CallAlert.jsx","components/ChatWidget/components/ChatTab.jsx","components/ChatWidget/index.jsx","apis/room.js","utils/Janus/videocall.js","App.js","serviceWorker.js","reducer/ChatWidget/reducer.js","reducer/Janus/reducer.js","reducer/index.js","index.js"],"names":["REQUIRE_ROOM","CHAT_NEW_MESSAGE","CHAT_SCROLLLOAD","FROM_USER_ID","FROM_NAME","TO_CALL_PARTNER_USERNAME","axios","create","baseURL","timeout","headers","paramsSerializer","params","queryString","stringify","prefix","newMessage","data","method","url","chatScrollLoad","JANUS_CONNECT","Janus","gatewayCallbacks","undefined","initDone","error","isWebrtcSupported","log","success","noop","destroyed","server","websockets","ws","wsHandlers","wsKeepaliveTimeoutId","servers","serversIndex","Array","isArray","length","debug","indexOf","iceServers","urls","iceTransportPolicy","ipv6Support","ipv6","withCredentials","maxev","max_poll_events","token","apisecret","this","destroyOnUnload","connected","sessionId","pluginHandles","that","retries","transactions","eventHandler","longpoll","Date","getTime","ajax","type","cache","handleEvent","XMLHttpRequest","textStatus","errorThrown","dataType","warn","json","skipTimeout","setTimeout","sender","pluginHandle","webrtcState","hangup","detached","ondetached","detach","mediaState","slowLink","code","reason","transaction","reportSuccess","plugindata","jsep","callback","onmessage","vdebug","i","keepAlive","request","janus","session_id","randomString","send","JSON","sendMessage","handleId","callbacks","message","body","console","contentType","sendTrickleCandidate","candidate","sendData","webrtcStuff","config","text","dataChannel","sendDtmf","dtmfSender","myStream","tracks","getAudioTracks","local_audio_track","pc","createDTMFSender","ontonechange","tone","dtmf","tones","duration","gap","insertDTMF","destroyHandle","asyncRequest","cleanupWebrtc","async","streamsDone","media","stream","pc_config","pc_constraints","optional","DtlsSrtpKeyAgreement","push","googIPv6","adapter","browserDetails","browser","bundlePolicy","RTCPeerConnection","getStats","volume","value","bitrate","trickle","oniceconnectionstatechange","e","iceState","iceConnectionState","onicecandidate","event","iceDone","completed","mySdp","localDescription","sdp","sdpSent","sendSDP","sdpMid","sdpMLineIndex","addStream","onlocalstream","onaddstream","remoteStream","onremotestream","isDataEnabled","onDataChannelStateChange","dcState","readyState","ondataopen","createDataChannel","ordered","ondata","onopen","onclose","onerror","createOffer","setRemoteDescription","RTCSessionDescription","createAnswer","prepareWebrtc","webrtcError","streamExternal","isAudioSendEnabled","isVideoSendEnabled","constraints","mandatory","consentDialog","audioSupport","audio","videoSupport","video","width","height","maxHeight","navigator","mozGetUserMedia","firefoxVer","parseInt","window","userAgent","match","require","max","min","ideal","minHeight","maxWidth","minWidth","callbackUserMedia","name","getScreenMedia","gsmCallback","useAudio","mediaDevices","getUserMedia","then","audioStream","addTrack","catch","screenshareFrameRate","location","protocol","chromever","version","maxver","googLeakyBucket","screen","minFrameRate","maxFrameRate","chromeMediaSource","pending","Error","postMessage","id","mozMediaSource","mediaSource","err","lastTime","currentTime","polly","setInterval","clearInterval","onended","addEventListener","origin","sourceId","googTemporalLayeredScreencast","chromeMediaSourceId","clearTimeout","enumerateDevices","devices","audioExist","some","device","kind","videoExist","audioSend","videoSend","needAudioDevice","failIfNoAudio","isAudioSendRequired","needVideoDevice","failIfNoVideo","isVideoSendRequired","haveAudioDevice","haveVideoDevice","prepareWebrtcPeer","mediaConstraints","offerToReceiveAudio","isAudioRecvEnabled","offerToReceiveVideo","isVideoRecvEnabled","OfferToReceiveAudio","OfferToReceiveVideo","offer","setLocalDescription","answer","getVolume","timer","stats","results","result","res","stat","isMuted","getVideoTracks","enabled","mute","getBitrate","bsnow","tsnow","timestamp","bsbefore","tsbefore","bitRate","Math","round","streams","videoTracks","cb","inbound_rtp_video_1","bytesReceived","hangupRequest","stop","getTracks","mst","close","oncleanup","audioRecv","videoRecv","createSession","eventName","WebSocket","open","sessions","parse","getServer","isConnected","getSessionId","destroy","unbindWebSocket","removeEventListener","onUnbindMessage","onUnbindError","destroySession","attach","plugin","opaqueId","opaque_id","session","started","getId","getPlugin","isAudioMuted","muteAudio","unmuteAudio","isVideoMuted","muteVideo","unmuteVideo","handleRemoteJsep","sendRequest","createHandle","extensionId","isExtensionEnabled","document","getElementById","init","options","trace","bind","d","listDevices","attachMediaStream","element","srcObject","src","URL","createObjectURL","reattachMediaStream","to","from","XHR","setRequestHeader","onreadystatechange","status","responseText","oldOBF","onbeforeunload","s","len","charSet","randomPoz","floor","random","substring","chatroomHandler","chatroom","callbackDispatch","textroom","room","ack","eventJanus","dataBody","room_id","partner_user_id","time","dayjs","valueOf","dispatch","getState","a","responseMessage","payload","newMessageChatWidget","AddMsgReply","handleCancelAddMsgReply","messReplyContent","className","onClick","icon","faTimes","AddMsgBox","addMsgReplyVisible","useDispatch","useState","currentMessage","setCurrentMessage","useSelector","state","chat","listCount","list","title","accept","faCamera","onChange","target","onKeyUp","keyCode","preventDefault","querySelector","click","dataJanus","uuidv4","faPaperPlane","ChatTabSearchBar","props","placeholder","ChatTabGroupTitle","handleClickPhoneBtn","handleClickSeachBtn","handleClickMinimizedIcon","searchBarVisible","faPhoneAlt","faSearch","faMinus","PostReply","handleClickReplyBtn","messContent","username","format","faReply","parser","toReact","alt","PostSent","Posts","containerRef","useRef","isInter","setIsInter","prevRatio","setPrevRatio","handleIntersect","entries","observer","forEach","entry","intersectionRatio","useEffect","IntersectionObserver","current","observe","unobserve","useElementOnScreen","root","rootMargin","threshold","scrollChatPost","scrollTop","scrollHeight","map","partner_id","split","CallAlert","handleClickCancelBtn","handleClickAcceptBtn","currentCallTime","setCurrentCallTime","useMicrophone","setUseMicrophone","customCss","border","borderRadius","controls","autoPlay","playsInline","muted","onTimeUpdate","track","timeStamp","timeFormat","style","faMicrophone","faMicrophoneSlash","ChatTab","position","callModalVisible","marginRight","right","marginLeft","ChatWidget","isPublisher","display","chatTabVisible","setChatTabVisible","setSearchBarVisible","setCallModalVisible","setAddMsgReplyVisible","janusInstance","setJanusInstance","setChatroomHandler","setMessReplyContent","videocallHandler","setVideocallHandler","setCallStatus","setJsep","responseRoom","requireRoomAction","from_user_id","from_name","to_partner_id","responseChat","count","scrollLoadStatus","chatroomId","on","msg","roomId","date","publishChatroom","_chatroomHandler","eventType","videocall","mp","publishVideoCall","_videocallHandler","_jsep","eventResult","simulcast","doCall","doHangup","doAccept","App","Boolean","hostname","initialState","chatReducer","action","reverse","janusReducer","rootReducer","combineReducers","composeSetup","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","thunk","ReactDOM","render","StrictMode","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.51fe7710.chunk.js","sourcesContent":["export const REQUIRE_ROOM = {\r\n  REQUEST: \"REQUIRE_ROOM_REQUEST\",\r\n  SUCCESS: \"REQUIRE_ROOM_SUCCESS\",\r\n  ERROR: \"REQUIRE_ROOM_ERROR\",\r\n};\r\nexport const CHAT_NEW_MESSAGE = {\r\n  REQUEST: \"CHAT_NEW_MESSAGE_REQUEST\",\r\n  SUCCESS: \"CHAT_NEW_MESSAGE_SUCCESS\",\r\n  ERROR: \"CHAT_NEW_MESSAGE_ERROR\",\r\n};\r\nexport const CHAT_SCROLLLOAD = {\r\n  REQUEST: \"CHAT_SCROLLLOAD_REQUEST\",\r\n  SUCCESS: \"CHAT_SCROLLLOAD_SUCCESS\",\r\n  ERROR: \"CHAT_SCROLLLOAD_ERROR\",\r\n};\r\n","export const JANUS_SERVER = \"wss://chat.hasaki.vn:8989\";\r\nexport const CHAT_API = \"https://chat.hasaki.vn\";\r\n\r\nexport const FROM_USER_ID = 200;\r\nexport const FROM_NAME = \"Nguyn Trung c\";\r\nexport const TO_PARTNER_ID = 1;\r\n\r\nexport const ROOM_ID = \"2-\" + TO_PARTNER_ID + \"-\" + FROM_USER_ID;\r\n// export const ROOM_ID = \"xx-111-test222443\"\r\nexport const USER_NAME = \"2\" + \"-\" + FROM_USER_ID + \"-Nguyn Trung c\";\r\n// 2-200-Nguyn Trung c\r\n\r\n// export const TO_CALL_PARTNER_USERNAME = \"test\";\r\n\r\n// [img]https://avatars.dicebear.com/api/male/Nguy%E1%BB%85n%20Trung%20%C4%90%E1%BB%A9c.svg[/img]\r\n\r\nexport const TO_CALL_PARTNER_USERNAME = \"1-4652-Nguyn c Ch\";\r\n// 1-4652-Nguyn c Ch\r\n","import axios from \"axios\";\r\n// import Cookies from 'js-cookie';\r\nimport queryString from \"query-string\";\r\nimport { CHAT_API } from \"../web.config\";\r\n\r\nexport default axios.create({\r\n  baseURL: CHAT_API,\r\n  timeout: 50000,\r\n  headers: {\r\n    \"content-type\": \"application/json\",\r\n    \"x-hskchat-app-id\": \"8220ce43-fb61-42c2-9308-7adc70203e88\",\r\n    \"x-hskchat-app-token\": \"wYBPg75D2pI9p4K7NzKKvV8TtNVjcMz9\",\r\n  },\r\n  paramsSerializer: (params) => queryString.stringify(params),\r\n  // validateStatus: (status) => {\r\n  //   return true; // I'm always returning true, you may want to do it depending on the status received\r\n  // },\r\n});\r\n","import axios from \"../utils/request\";\r\n\r\nconst prefix = \"/api/v1/chat\";\r\n\r\nexport const newMessage = (data) => {\r\n  return axios({\r\n    method: \"POST\",\r\n    url: `${prefix}/new`,\r\n    data,\r\n  });\r\n};\r\n\r\nexport const chatScrollLoad = (params = {}) => {\r\n  return axios({\r\n    method: \"GET\",\r\n    url: `${prefix}/scrollLoad`,\r\n    params: {\r\n      ...params,\r\n    },\r\n  });\r\n};\r\n\r\nexport const chatSearch = ({ raw }) => {\r\n  return axios({\r\n    method: \"GET\",\r\n    url: `${prefix}/search`,\r\n    data: {\r\n      ...raw,\r\n    },\r\n  });\r\n};\r\n","export const JANUS_CONNECT = {\r\n    REQUEST: \"JANUS_CONNECT_REQUEST_ACTION\",\r\n    SUCCESS: \"JANUS_CONNECT_SUCCESS_ACTION\",\r\n    ERROR: \"JANUS_CONNECT_ERROR_ACTION\",\r\n};","/*\r\n\tThe MIT License (MIT)\r\n\r\n\tCopyright (c) 2016 Meetecho\r\n\r\n\tPermission is hereby granted, free of charge, to any person obtaining\r\n\ta copy of this software and associated documentation files (the \"Software\"),\r\n\tto deal in the Software without restriction, including without limitation\r\n\tthe rights to use, copy, modify, merge, publish, distribute, sublicense,\r\n\tand/or sell copies of the Software, and to permit persons to whom the\r\n\tSoftware is furnished to do so, subject to the following conditions:\r\n\r\n\tThe above copyright notice and this permission notice shall be included\r\n\tin all copies or substantial portions of the Software.\r\n\r\n\tTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\r\n\tOR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n\tFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\r\n\tTHE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR\r\n\tOTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\r\n\tARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\r\n\tOTHER DEALINGS IN THE SOFTWARE.\r\n */\r\n\r\nimport adapter from \"webrtc-adapter\";\r\n\r\n// List of sessions\r\nJanus.sessions = {};\r\n\r\n// Screensharing Chrome Extension ID\r\nJanus.extensionId = \"hapfgfdkleiggjjpfpenajgdnfckjpaj\";\r\nJanus.isExtensionEnabled = function () {\r\n  if (window.navigator.userAgent.match(\"Chrome\")) {\r\n    var chromever = parseInt(window.navigator.userAgent.match(/Chrome\\/(.*) /)[1], 10);\r\n    var maxver = 33;\r\n    if (window.navigator.userAgent.match(\"Linux\")) maxver = 35; // \"known\" crash in chrome 34 and 35 on linux\r\n    if (chromever >= 26 && chromever <= maxver) {\r\n      // Older versions of Chrome don't support this extension-based approach, so lie\r\n      return true;\r\n    }\r\n    return document.getElementById(\"janus-extension-installed\") !== null;\r\n  } else {\r\n    // Firefox of others, no need for the extension (but this doesn't mean it will work)\r\n    return true;\r\n  }\r\n};\r\n\r\nJanus.noop = function () {};\r\n\r\n// Initialization\r\nJanus.init = function (options) {\r\n  options = options || {};\r\n  options.callback = typeof options.callback == \"function\" ? options.callback : Janus.noop;\r\n  if (Janus.initDone === true) {\r\n    // Already initialized\r\n    options.callback();\r\n  } else {\r\n    if (typeof console == \"undefined\" || typeof console.log == \"undefined\")\r\n      console = { log: function () {} };\r\n    // Console logging (all debugging disabled by default)\r\n    Janus.trace = Janus.noop;\r\n    Janus.debug = Janus.noop;\r\n    Janus.vdebug = Janus.noop;\r\n    Janus.log = Janus.noop;\r\n    Janus.warn = Janus.noop;\r\n    Janus.error = Janus.noop;\r\n    if (options.debug === true || options.debug === \"all\") {\r\n      // Enable all debugging levels\r\n      Janus.trace = console.trace.bind(console);\r\n      Janus.debug = console.debug.bind(console);\r\n      Janus.vdebug = console.debug.bind(console);\r\n      Janus.log = console.log.bind(console);\r\n      Janus.warn = console.warn.bind(console);\r\n      Janus.error = console.error.bind(console);\r\n    } else if (Array.isArray(options.debug)) {\r\n      for (var i in options.debug) {\r\n        var d = options.debug[i];\r\n        switch (d) {\r\n          case \"trace\":\r\n            Janus.trace = console.trace.bind(console);\r\n            break;\r\n          case \"debug\":\r\n            Janus.debug = console.debug.bind(console);\r\n            break;\r\n          case \"vdebug\":\r\n            Janus.vdebug = console.debug.bind(console);\r\n            break;\r\n          case \"log\":\r\n            Janus.log = console.log.bind(console);\r\n            break;\r\n          case \"warn\":\r\n            Janus.warn = console.warn.bind(console);\r\n            break;\r\n          case \"error\":\r\n            Janus.error = console.error.bind(console);\r\n            break;\r\n          default:\r\n            console.error(\r\n              \"Unknown debugging option '\" +\r\n                d +\r\n                \"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')\"\r\n            );\r\n            break;\r\n        }\r\n      }\r\n    }\r\n    Janus.log(\"Initializing library\");\r\n    // Helper method to enumerate devices\r\n    Janus.listDevices = function (callback, config) {\r\n      callback = typeof callback == \"function\" ? callback : Janus.noop;\r\n      if (config == null) config = { audio: true, video: true };\r\n      if (navigator.mediaDevices) {\r\n        navigator.mediaDevices\r\n          .getUserMedia(config)\r\n          .then(function (stream) {\r\n            navigator.mediaDevices.enumerateDevices().then(function (devices) {\r\n              Janus.debug(devices);\r\n              callback(devices);\r\n              // Get rid of the now useless stream\r\n              try {\r\n                stream.stop();\r\n              } catch (e) {}\r\n              try {\r\n                var tracks = stream.getTracks();\r\n                for (var i in tracks) {\r\n                  var mst = tracks[i];\r\n                  if (mst !== null && mst !== undefined) mst.stop();\r\n                }\r\n              } catch (e) {}\r\n            });\r\n          })\r\n          .catch(function (err) {\r\n            Janus.error(err);\r\n            callback([]);\r\n          });\r\n      } else {\r\n        Janus.warn(\"navigator.mediaDevices unavailable\");\r\n        callback([]);\r\n      }\r\n    };\r\n    // Helper methods to attach/reattach a stream to a video element (previously part of adapter.js)\r\n    Janus.attachMediaStream = function (element, stream) {\r\n      if (adapter.browserDetails.browser === \"chrome\") {\r\n        var chromever = adapter.browserDetails.version;\r\n        if (chromever >= 43) {\r\n          element.srcObject = stream;\r\n        } else if (typeof element.src !== \"undefined\") {\r\n          element.src = URL.createObjectURL(stream);\r\n        } else {\r\n          Janus.error(\"Error attaching stream to element\");\r\n        }\r\n      } else {\r\n        element.srcObject = stream;\r\n      }\r\n    };\r\n    Janus.reattachMediaStream = function (to, from) {\r\n      if (adapter.browserDetails.browser === \"chrome\") {\r\n        var chromever = adapter.browserDetails.version;\r\n        if (chromever >= 43) {\r\n          to.srcObject = from.srcObject;\r\n        } else if (typeof to.src !== \"undefined\") {\r\n          to.src = from.src;\r\n        }\r\n      } else if (\r\n        adapter.browserDetails.browser === \"safari\" ||\r\n        window.navigator.userAgent.match(/iPad/i) ||\r\n        window.navigator.userAgent.match(/iPhone/i)\r\n      ) {\r\n        to.src = from.src;\r\n      } else {\r\n        to.srcObject = from.srcObject;\r\n      }\r\n    };\r\n    // Prepare a helper method to send AJAX requests in a syntax similar to jQuery (at least for what we care)\r\n    Janus.ajax = function (params) {\r\n      // Check params\r\n      if (params === null || params === undefined) return;\r\n      params.success = typeof params.success == \"function\" ? params.success : Janus.noop;\r\n      params.error = typeof params.error == \"function\" ? params.error : Janus.noop;\r\n      // Make sure there's an URL\r\n      if (params.url === null || params.url === undefined) {\r\n        Janus.error(\"Missing url\", params.url);\r\n        params.error(null, -1, \"Missing url\");\r\n        return;\r\n      }\r\n      // Validate async\r\n      params.async =\r\n        params.async === null || params.async === undefined ? true : params.async === true;\r\n      Janus.log(params);\r\n      // IE doesn't even know what WebRTC is, so no polyfill needed\r\n      var XHR = new XMLHttpRequest();\r\n      XHR.open(params.type, params.url, params.async);\r\n      if (params.contentType !== null && params.contentType !== undefined)\r\n        XHR.setRequestHeader(\"Content-type\", params.contentType);\r\n      if (params.withCredentials !== null && params.withCredentials !== undefined)\r\n        XHR.withCredentials = params.withCredentials;\r\n      if (params.async) {\r\n        XHR.onreadystatechange = function () {\r\n          if (XHR.readyState != 4) return;\r\n          if (XHR.status !== 200) {\r\n            // Got an error?\r\n            params.error(XHR, XHR.status !== 0 ? XHR.status : \"error\", \"\");\r\n            return;\r\n          }\r\n          // Got payload\r\n          try {\r\n            params.success(JSON.parse(XHR.responseText));\r\n          } catch (e) {\r\n            params.error(\r\n              XHR,\r\n              XHR.status,\r\n              \"Could not parse response, error: \" + e + \", text: \" + XHR.responseText\r\n            );\r\n          }\r\n        };\r\n      }\r\n      try {\r\n        XHR.send(params.data);\r\n        if (!params.async) {\r\n          if (XHR.status !== 200) {\r\n            // Got an error?\r\n            params.error(XHR, XHR.status !== 0 ? XHR.status : \"error\", \"\");\r\n            return;\r\n          }\r\n          // Got payload\r\n          try {\r\n            params.success(JSON.parse(XHR.responseText));\r\n          } catch (e) {\r\n            params.error(\r\n              XHR,\r\n              XHR.status,\r\n              \"Could not parse response, error: \" + e + \", text: \" + XHR.responseText\r\n            );\r\n          }\r\n        }\r\n      } catch (e) {\r\n        // Something broke up\r\n        params.error(XHR, \"error\", \"\");\r\n      }\r\n    };\r\n    // Detect tab close: make sure we don't loose existing onbeforeunload handlers\r\n    var oldOBF = window.onbeforeunload;\r\n    window.onbeforeunload = function () {\r\n      Janus.log(\"Closing window\");\r\n      for (var s in Janus.sessions) {\r\n        if (\r\n          Janus.sessions[s] !== null &&\r\n          Janus.sessions[s] !== undefined &&\r\n          Janus.sessions[s].destroyOnUnload\r\n        ) {\r\n          Janus.log(\"Destroying session \" + s);\r\n          Janus.sessions[s].destroy({ asyncRequest: false });\r\n        }\r\n      }\r\n      if (oldOBF && typeof oldOBF == \"function\") oldOBF();\r\n    };\r\n    Janus.initDone = true;\r\n    options.callback();\r\n  }\r\n};\r\n\r\n// Helper method to check whether WebRTC is supported by this browser\r\nJanus.isWebrtcSupported = function () {\r\n  return (\r\n    window.RTCPeerConnection !== undefined &&\r\n    window.RTCPeerConnection !== null &&\r\n    navigator.getUserMedia !== undefined &&\r\n    navigator.getUserMedia !== null\r\n  );\r\n};\r\n\r\n// Helper method to create random identifiers (e.g., transaction)\r\nJanus.randomString = function (len) {\r\n  var charSet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n  var randomString = \"\";\r\n  for (var i = 0; i < len; i++) {\r\n    var randomPoz = Math.floor(Math.random() * charSet.length);\r\n    randomString += charSet.substring(randomPoz, randomPoz + 1);\r\n  }\r\n  return randomString;\r\n};\r\n\r\n// Janus session object\r\nfunction Janus(gatewayCallbacks) {\r\n  if (Janus.initDone === undefined) {\r\n    gatewayCallbacks.error(\"Library not initialized\");\r\n    return {};\r\n  }\r\n  if (!Janus.isWebrtcSupported()) {\r\n    gatewayCallbacks.error(\"WebRTC not supported by this browser\");\r\n    return {};\r\n  }\r\n  Janus.log(\"Library initialized: \" + Janus.initDone);\r\n  gatewayCallbacks = gatewayCallbacks || {};\r\n  gatewayCallbacks.success =\r\n    typeof gatewayCallbacks.success == \"function\" ? gatewayCallbacks.success : Janus.noop;\r\n  gatewayCallbacks.error =\r\n    typeof gatewayCallbacks.error == \"function\" ? gatewayCallbacks.error : Janus.noop;\r\n  gatewayCallbacks.destroyed =\r\n    typeof gatewayCallbacks.destroyed == \"function\" ? gatewayCallbacks.destroyed : Janus.noop;\r\n  if (gatewayCallbacks.server === null || gatewayCallbacks.server === undefined) {\r\n    gatewayCallbacks.error(\"Invalid gateway url\");\r\n    return {};\r\n  }\r\n  var websockets = false;\r\n  var ws = null;\r\n  var wsHandlers = {};\r\n  var wsKeepaliveTimeoutId = null;\r\n\r\n  var servers = null,\r\n    serversIndex = 0;\r\n  var server = gatewayCallbacks.server;\r\n  if (Array.isArray(server)) {\r\n    Janus.log(\"Multiple servers provided (\" + server.length + \"), will use the first that works\");\r\n    server = null;\r\n    servers = gatewayCallbacks.server;\r\n    Janus.debug(servers);\r\n  } else {\r\n    if (server.indexOf(\"ws\") === 0) {\r\n      websockets = true;\r\n      Janus.log(\"Using WebSockets to contact Janus: \" + server);\r\n    } else {\r\n      websockets = false;\r\n      Janus.log(\"Using REST API to contact Janus: \" + server);\r\n    }\r\n  }\r\n  var iceServers = gatewayCallbacks.iceServers;\r\n  if (iceServers === undefined || iceServers === null)\r\n    iceServers = [{ urls: \"stun:stun.l.google.com:19302\" }];\r\n  var iceTransportPolicy = gatewayCallbacks.iceTransportPolicy;\r\n  // Whether IPv6 candidates should be gathered\r\n  var ipv6Support = gatewayCallbacks.ipv6;\r\n  if (ipv6Support === undefined || ipv6Support === null) ipv6Support = false;\r\n  // Whether we should enable the withCredentials flag for XHR requests\r\n  var withCredentials = false;\r\n  if (gatewayCallbacks.withCredentials !== undefined && gatewayCallbacks.withCredentials !== null)\r\n    withCredentials = gatewayCallbacks.withCredentials === true;\r\n  // Optional max events\r\n  var maxev = null;\r\n  if (gatewayCallbacks.max_poll_events !== undefined && gatewayCallbacks.max_poll_events !== null)\r\n    maxev = gatewayCallbacks.max_poll_events;\r\n  if (maxev < 1) maxev = 1;\r\n  // Token to use (only if the token based authentication mechanism is enabled)\r\n  var token = null;\r\n  if (gatewayCallbacks.token !== undefined && gatewayCallbacks.token !== null)\r\n    token = gatewayCallbacks.token;\r\n  // API secret to use (only if the shared API secret is enabled)\r\n  var apisecret = null;\r\n  if (gatewayCallbacks.apisecret !== undefined && gatewayCallbacks.apisecret !== null)\r\n    apisecret = gatewayCallbacks.apisecret;\r\n  // Whether we should destroy this session when onbeforeunload is called\r\n  this.destroyOnUnload = true;\r\n  if (gatewayCallbacks.destroyOnUnload !== undefined && gatewayCallbacks.destroyOnUnload !== null)\r\n    this.destroyOnUnload = gatewayCallbacks.destroyOnUnload === true;\r\n\r\n  var connected = false;\r\n  var sessionId = null;\r\n  var pluginHandles = {};\r\n  var that = this;\r\n  var retries = 0;\r\n  var transactions = {};\r\n  createSession(gatewayCallbacks);\r\n\r\n  // Public methods\r\n  this.getServer = function () {\r\n    return server;\r\n  };\r\n  this.isConnected = function () {\r\n    return connected;\r\n  };\r\n  this.getSessionId = function () {\r\n    return sessionId;\r\n  };\r\n  this.destroy = function (callbacks) {\r\n    destroySession(callbacks, true);\r\n  };\r\n  this.attach = function (callbacks) {\r\n    createHandle(callbacks);\r\n  };\r\n\r\n  function eventHandler() {\r\n    if (sessionId == null) return;\r\n    Janus.debug(\"Long poll...\");\r\n    if (!connected) {\r\n      Janus.warn(\"Is the gateway down? (connected=false)\");\r\n      return;\r\n    }\r\n    var longpoll = server + \"/\" + sessionId + \"?rid=\" + new Date().getTime();\r\n    if (maxev !== undefined && maxev !== null) longpoll = longpoll + \"&maxev=\" + maxev;\r\n    if (token !== null && token !== undefined) longpoll = longpoll + \"&token=\" + token;\r\n    if (apisecret !== null && apisecret !== undefined)\r\n      longpoll = longpoll + \"&apisecret=\" + apisecret;\r\n    Janus.ajax({\r\n      type: \"GET\",\r\n      url: longpoll,\r\n      withCredentials: withCredentials,\r\n      cache: false,\r\n      timeout: 60000, // FIXME\r\n      success: handleEvent,\r\n      error: function (XMLHttpRequest, textStatus, errorThrown) {\r\n        Janus.error(textStatus + \": \" + errorThrown);\r\n        retries++;\r\n        if (retries > 3) {\r\n          // Did we just lose the gateway? :-(\r\n          connected = false;\r\n          gatewayCallbacks.error(\"Lost connection to the gateway (is it down?)\");\r\n          return;\r\n        }\r\n        eventHandler();\r\n      },\r\n      dataType: \"json\",\r\n    });\r\n  }\r\n\r\n  // Private event handler: this will trigger plugin callbacks, if set\r\n  function handleEvent(json, skipTimeout) {\r\n    retries = 0;\r\n    if (!websockets && sessionId !== undefined && sessionId !== null && skipTimeout !== true)\r\n      setTimeout(eventHandler, 200);\r\n    if (!websockets && Array.isArray(json)) {\r\n      // We got an array: it means we passed a maxev > 1, iterate on all objects\r\n      for (var i = 0; i < json.length; i++) {\r\n        handleEvent(json[i], true);\r\n      }\r\n      return;\r\n    }\r\n    if (json[\"janus\"] === \"keepalive\") {\r\n      // Nothing happened\r\n      Janus.vdebug(\"Got a keepalive on session \" + sessionId);\r\n      return;\r\n    } else if (json[\"janus\"] === \"ack\") {\r\n      // Just an ack, we can probably ignore\r\n      Janus.debug(\"Got an ack on session \" + sessionId);\r\n      Janus.debug(json);\r\n      var transaction = json[\"transaction\"];\r\n      if (transaction !== null && transaction !== undefined) {\r\n        var reportSuccess = transactions[transaction];\r\n        if (reportSuccess !== null && reportSuccess !== undefined) {\r\n          reportSuccess(json);\r\n        }\r\n        delete transactions[transaction];\r\n      }\r\n      return;\r\n    } else if (json[\"janus\"] === \"success\") {\r\n      // Success!\r\n      Janus.debug(\"Got a success on session \" + sessionId);\r\n      Janus.debug(json);\r\n      var transaction = json[\"transaction\"];\r\n      if (transaction !== null && transaction !== undefined) {\r\n        var reportSuccess = transactions[transaction];\r\n        if (reportSuccess !== null && reportSuccess !== undefined) {\r\n          reportSuccess(json);\r\n        }\r\n        delete transactions[transaction];\r\n      }\r\n      return;\r\n    } else if (json[\"janus\"] === \"webrtcup\") {\r\n      // The PeerConnection with the gateway is up! Notify this\r\n      Janus.debug(\"Got a webrtcup event on session \" + sessionId);\r\n      Janus.debug(json);\r\n      var sender = json[\"sender\"];\r\n      if (sender === undefined || sender === null) {\r\n        Janus.warn(\"Missing sender...\");\r\n        return;\r\n      }\r\n      var pluginHandle = pluginHandles[sender];\r\n      if (pluginHandle === undefined || pluginHandle === null) {\r\n        Janus.debug(\"This handle is not attached to this session\");\r\n        return;\r\n      }\r\n      pluginHandle.webrtcState(true);\r\n      return;\r\n    } else if (json[\"janus\"] === \"hangup\") {\r\n      // A plugin asked the core to hangup a PeerConnection on one of our handles\r\n      Janus.debug(\"Got a hangup event on session \" + sessionId);\r\n      Janus.debug(json);\r\n      var sender = json[\"sender\"];\r\n      if (sender === undefined || sender === null) {\r\n        Janus.warn(\"Missing sender...\");\r\n        return;\r\n      }\r\n      var pluginHandle = pluginHandles[sender];\r\n      if (pluginHandle === undefined || pluginHandle === null) {\r\n        Janus.debug(\"This handle is not attached to this session\");\r\n        return;\r\n      }\r\n      pluginHandle.webrtcState(false, json[\"reason\"]);\r\n      pluginHandle.hangup();\r\n    } else if (json[\"janus\"] === \"detached\") {\r\n      // A plugin asked the core to detach one of our handles\r\n      Janus.debug(\"Got a detached event on session \" + sessionId);\r\n      Janus.debug(json);\r\n      var sender = json[\"sender\"];\r\n      if (sender === undefined || sender === null) {\r\n        Janus.warn(\"Missing sender...\");\r\n        return;\r\n      }\r\n      var pluginHandle = pluginHandles[sender];\r\n      if (pluginHandle === undefined || pluginHandle === null) {\r\n        // Don't warn here because destroyHandle causes this situation.\r\n        return;\r\n      }\r\n      pluginHandle.detached = true;\r\n      pluginHandle.ondetached();\r\n      pluginHandle.detach();\r\n    } else if (json[\"janus\"] === \"media\") {\r\n      // Media started/stopped flowing\r\n      Janus.debug(\"Got a media event on session \" + sessionId);\r\n      Janus.debug(json);\r\n      var sender = json[\"sender\"];\r\n      if (sender === undefined || sender === null) {\r\n        Janus.warn(\"Missing sender...\");\r\n        return;\r\n      }\r\n      var pluginHandle = pluginHandles[sender];\r\n      if (pluginHandle === undefined || pluginHandle === null) {\r\n        Janus.debug(\"This handle is not attached to this session\");\r\n        return;\r\n      }\r\n      pluginHandle.mediaState(json[\"type\"], json[\"receiving\"]);\r\n    } else if (json[\"janus\"] === \"slowlink\") {\r\n      Janus.debug(\"Got a slowlink event on session \" + sessionId);\r\n      Janus.debug(json);\r\n      // Trouble uplink or downlink\r\n      var sender = json[\"sender\"];\r\n      if (sender === undefined || sender === null) {\r\n        Janus.warn(\"Missing sender...\");\r\n        return;\r\n      }\r\n      var pluginHandle = pluginHandles[sender];\r\n      if (pluginHandle === undefined || pluginHandle === null) {\r\n        Janus.debug(\"This handle is not attached to this session\");\r\n        return;\r\n      }\r\n      pluginHandle.slowLink(json[\"uplink\"], json[\"nacks\"]);\r\n    } else if (json[\"janus\"] === \"error\") {\r\n      // Oops, something wrong happened\r\n      Janus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason); // FIXME\r\n      Janus.debug(json);\r\n      var transaction = json[\"transaction\"];\r\n      if (transaction !== null && transaction !== undefined) {\r\n        var reportSuccess = transactions[transaction];\r\n        if (reportSuccess !== null && reportSuccess !== undefined) {\r\n          reportSuccess(json);\r\n        }\r\n        delete transactions[transaction];\r\n      }\r\n      return;\r\n    } else if (json[\"janus\"] === \"event\") {\r\n      Janus.debug(\"Got a plugin event on session \" + sessionId);\r\n      Janus.debug(json);\r\n      var sender = json[\"sender\"];\r\n      if (sender === undefined || sender === null) {\r\n        Janus.warn(\"Missing sender...\");\r\n        return;\r\n      }\r\n      var plugindata = json[\"plugindata\"];\r\n      if (plugindata === undefined || plugindata === null) {\r\n        Janus.warn(\"Missing plugindata...\");\r\n        return;\r\n      }\r\n      Janus.debug(\"  -- Event is coming from \" + sender + \" (\" + plugindata[\"plugin\"] + \")\");\r\n      var data = plugindata[\"data\"];\r\n      Janus.debug(data);\r\n      var pluginHandle = pluginHandles[sender];\r\n      if (pluginHandle === undefined || pluginHandle === null) {\r\n        Janus.warn(\"This handle is not attached to this session\");\r\n        return;\r\n      }\r\n      var jsep = json[\"jsep\"];\r\n      if (jsep !== undefined && jsep !== null) {\r\n        Janus.debug(\"Handling SDP as well...\");\r\n        Janus.debug(jsep);\r\n      }\r\n      var callback = pluginHandle.onmessage;\r\n      if (callback !== null && callback !== undefined) {\r\n        Janus.debug(\"Notifying application...\");\r\n        // Send to callback specified when attaching plugin handle\r\n        callback(data, jsep);\r\n      } else {\r\n        // Send to generic callback (?)\r\n        Janus.debug(\"No provided notification callback\");\r\n      }\r\n    } else {\r\n      Janus.warn(\"Unkown message/event  '\" + json[\"janus\"] + \"' on session \" + sessionId);\r\n      Janus.debug(json);\r\n    }\r\n  }\r\n\r\n  // Private helper to send keep-alive messages on WebSockets\r\n  function keepAlive() {\r\n    if (server === null || !websockets || !connected) return;\r\n    wsKeepaliveTimeoutId = setTimeout(keepAlive, 30000);\r\n    var request = {\r\n      janus: \"keepalive\",\r\n      session_id: sessionId,\r\n      transaction: Janus.randomString(12),\r\n    };\r\n    if (token !== null && token !== undefined) request[\"token\"] = token;\r\n    if (apisecret !== null && apisecret !== undefined) request[\"apisecret\"] = apisecret;\r\n    ws.send(JSON.stringify(request));\r\n  }\r\n\r\n  // Private method to create a session\r\n  function createSession(callbacks) {\r\n    var transaction = Janus.randomString(12);\r\n    var request = { janus: \"create\", transaction: transaction };\r\n    if (token !== null && token !== undefined) request[\"token\"] = token;\r\n    if (apisecret !== null && apisecret !== undefined) request[\"apisecret\"] = apisecret;\r\n    if (server === null && Array.isArray(servers)) {\r\n      // We still need to find a working server from the list we were given\r\n      server = servers[serversIndex];\r\n      if (server.indexOf(\"ws\") === 0) {\r\n        websockets = true;\r\n        Janus.log(\r\n          \"Server #\" + (serversIndex + 1) + \": trying WebSockets to contact Janus (\" + server + \")\"\r\n        );\r\n      } else {\r\n        websockets = false;\r\n        Janus.log(\r\n          \"Server #\" + (serversIndex + 1) + \": trying REST API to contact Janus (\" + server + \")\"\r\n        );\r\n      }\r\n    }\r\n    if (websockets) {\r\n      ws = new WebSocket(server, \"janus-protocol\");\r\n      wsHandlers = {\r\n        error: function () {\r\n          Janus.error(\"Error connecting to the Janus WebSockets server... \" + server);\r\n          if (Array.isArray(servers)) {\r\n            serversIndex++;\r\n            if (serversIndex == servers.length) {\r\n              // We tried all the servers the user gave us and they all failed\r\n              callbacks.error(\r\n                \"Error connecting to any of the provided Janus servers: Is the gateway down?\"\r\n              );\r\n              return;\r\n            }\r\n            // Let's try the next server\r\n            server = null;\r\n            setTimeout(function () {\r\n              createSession(callbacks);\r\n            }, 200);\r\n            return;\r\n          }\r\n          callbacks.error(\"Error connecting to the Janus WebSockets server: Is the gateway down?\");\r\n        },\r\n\r\n        open: function () {\r\n          // We need to be notified about the success\r\n          transactions[transaction] = function (json) {\r\n            Janus.debug(json);\r\n            if (json[\"janus\"] !== \"success\") {\r\n              Janus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason); // FIXME\r\n              callbacks.error(json[\"error\"].reason);\r\n              return;\r\n            }\r\n            wsKeepaliveTimeoutId = setTimeout(keepAlive, 30000);\r\n            connected = true;\r\n            sessionId = json.data[\"id\"];\r\n            Janus.log(\"Created session: \" + sessionId);\r\n            Janus.sessions[sessionId] = that;\r\n            callbacks.success();\r\n          };\r\n          ws.send(JSON.stringify(request));\r\n        },\r\n\r\n        message: function (event) {\r\n          try {\r\n            handleEvent(JSON.parse(event.data));\r\n          } catch (e) {\r\n            Janus.error(\"Error processing event:\", e);\r\n          }\r\n        },\r\n\r\n        close: function () {\r\n          if (server === null || !connected) {\r\n            return;\r\n          }\r\n          connected = false;\r\n          // FIXME What if this is called when the page is closed?\r\n          gatewayCallbacks.error(\"Lost connection to the gateway (is it down?)\");\r\n        },\r\n      };\r\n\r\n      for (var eventName in wsHandlers) {\r\n        ws.addEventListener(eventName, wsHandlers[eventName]);\r\n      }\r\n\r\n      return;\r\n    }\r\n    Janus.ajax({\r\n      type: \"POST\",\r\n      url: server,\r\n      withCredentials: withCredentials,\r\n      cache: false,\r\n      contentType: \"application/json\",\r\n      data: JSON.stringify(request),\r\n      success: function (json) {\r\n        Janus.debug(json);\r\n        if (json[\"janus\"] !== \"success\") {\r\n          Janus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason); // FIXME\r\n          callbacks.error(json[\"error\"].reason);\r\n          return;\r\n        }\r\n        connected = true;\r\n        sessionId = json.data[\"id\"];\r\n        Janus.log(\"Created session: \" + sessionId);\r\n        Janus.sessions[sessionId] = that;\r\n        eventHandler();\r\n        callbacks.success();\r\n      },\r\n      error: function (XMLHttpRequest, textStatus, errorThrown) {\r\n        Janus.error(textStatus + \": \" + errorThrown); // FIXME\r\n        if (Array.isArray(servers)) {\r\n          serversIndex++;\r\n          if (serversIndex == servers.length) {\r\n            // We tried all the servers the user gave us and they all failed\r\n            callbacks.error(\r\n              \"Error connecting to any of the provided Janus servers: Is the gateway down?\"\r\n            );\r\n            return;\r\n          }\r\n          // Let's try the next server\r\n          server = null;\r\n          setTimeout(function () {\r\n            createSession(callbacks);\r\n          }, 200);\r\n          return;\r\n        }\r\n        if (errorThrown === \"\") callbacks.error(textStatus + \": Is the gateway down?\");\r\n        else callbacks.error(textStatus + \": \" + errorThrown);\r\n      },\r\n      dataType: \"json\",\r\n    });\r\n  }\r\n\r\n  // Private method to destroy a session\r\n  function destroySession(callbacks) {\r\n    callbacks = callbacks || {};\r\n    // FIXME This method triggers a success even when we fail\r\n    callbacks.success = typeof callbacks.success == \"function\" ? callbacks.success : Janus.noop;\r\n    var asyncRequest = true;\r\n    if (callbacks.asyncRequest !== undefined && callbacks.asyncRequest !== null)\r\n      asyncRequest = callbacks.asyncRequest === true;\r\n    Janus.log(\"Destroying session \" + sessionId + \" (async=\" + asyncRequest + \")\");\r\n    if (!connected) {\r\n      Janus.warn(\"Is the gateway down? (connected=false)\");\r\n      callbacks.success();\r\n      return;\r\n    }\r\n    if (sessionId === undefined || sessionId === null) {\r\n      Janus.warn(\"No session to destroy\");\r\n      callbacks.success();\r\n      gatewayCallbacks.destroyed();\r\n      return;\r\n    }\r\n    delete Janus.sessions[sessionId];\r\n    // No need to destroy all handles first, Janus will do that itself\r\n    var request = { janus: \"destroy\", transaction: Janus.randomString(12) };\r\n    if (token !== null && token !== undefined) request[\"token\"] = token;\r\n    if (apisecret !== null && apisecret !== undefined) request[\"apisecret\"] = apisecret;\r\n    if (websockets) {\r\n      request[\"session_id\"] = sessionId;\r\n\r\n      var unbindWebSocket = function () {\r\n        for (var eventName in wsHandlers) {\r\n          ws.removeEventListener(eventName, wsHandlers[eventName]);\r\n        }\r\n        ws.removeEventListener(\"message\", onUnbindMessage);\r\n        ws.removeEventListener(\"error\", onUnbindError);\r\n        if (wsKeepaliveTimeoutId) {\r\n          clearTimeout(wsKeepaliveTimeoutId);\r\n        }\r\n      };\r\n\r\n      var onUnbindMessage = function (event) {\r\n        var data = JSON.parse(event.data);\r\n        if (data.session_id == request.session_id && data.transaction == request.transaction) {\r\n          unbindWebSocket();\r\n          callbacks.success();\r\n          gatewayCallbacks.destroyed();\r\n        }\r\n      };\r\n      var onUnbindError = function (event) {\r\n        unbindWebSocket();\r\n        callbacks.error(\"Failed to destroy the gateway: Is the gateway down?\");\r\n        gatewayCallbacks.destroyed();\r\n      };\r\n\r\n      ws.addEventListener(\"message\", onUnbindMessage);\r\n      ws.addEventListener(\"error\", onUnbindError);\r\n\r\n      ws.send(JSON.stringify(request));\r\n      return;\r\n    }\r\n    Janus.ajax({\r\n      type: \"POST\",\r\n      url: server + \"/\" + sessionId,\r\n      async: asyncRequest, // Sometimes we need false here, or destroying in onbeforeunload won't work\r\n      withCredentials: withCredentials,\r\n      cache: false,\r\n      contentType: \"application/json\",\r\n      data: JSON.stringify(request),\r\n      success: function (json) {\r\n        Janus.log(\"Destroyed session:\");\r\n        Janus.debug(json);\r\n        sessionId = null;\r\n        connected = false;\r\n        if (json[\"janus\"] !== \"success\") {\r\n          Janus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason); // FIXME\r\n        }\r\n        callbacks.success();\r\n        gatewayCallbacks.destroyed();\r\n      },\r\n      error: function (XMLHttpRequest, textStatus, errorThrown) {\r\n        Janus.error(textStatus + \": \" + errorThrown); // FIXME\r\n        // Reset everything anyway\r\n        sessionId = null;\r\n        connected = false;\r\n        callbacks.success();\r\n        gatewayCallbacks.destroyed();\r\n      },\r\n      dataType: \"json\",\r\n    });\r\n  }\r\n\r\n  // Private method to create a plugin handle\r\n  function createHandle(callbacks) {\r\n    callbacks = callbacks || {};\r\n    callbacks.success = typeof callbacks.success == \"function\" ? callbacks.success : Janus.noop;\r\n    callbacks.error = typeof callbacks.error == \"function\" ? callbacks.error : Janus.noop;\r\n    callbacks.consentDialog =\r\n      typeof callbacks.consentDialog == \"function\" ? callbacks.consentDialog : Janus.noop;\r\n    callbacks.iceState = typeof callbacks.iceState == \"function\" ? callbacks.iceState : Janus.noop;\r\n    callbacks.mediaState =\r\n      typeof callbacks.mediaState == \"function\" ? callbacks.mediaState : Janus.noop;\r\n    callbacks.webrtcState =\r\n      typeof callbacks.webrtcState == \"function\" ? callbacks.webrtcState : Janus.noop;\r\n    callbacks.slowLink = typeof callbacks.slowLink == \"function\" ? callbacks.slowLink : Janus.noop;\r\n    callbacks.onmessage =\r\n      typeof callbacks.onmessage == \"function\" ? callbacks.onmessage : Janus.noop;\r\n    callbacks.onlocalstream =\r\n      typeof callbacks.onlocalstream == \"function\" ? callbacks.onlocalstream : Janus.noop;\r\n    callbacks.onremotestream =\r\n      typeof callbacks.onremotestream == \"function\" ? callbacks.onremotestream : Janus.noop;\r\n    callbacks.ondata = typeof callbacks.ondata == \"function\" ? callbacks.ondata : Janus.noop;\r\n    callbacks.ondataopen =\r\n      typeof callbacks.ondataopen == \"function\" ? callbacks.ondataopen : Janus.noop;\r\n    callbacks.oncleanup =\r\n      typeof callbacks.oncleanup == \"function\" ? callbacks.oncleanup : Janus.noop;\r\n    callbacks.ondetached =\r\n      typeof callbacks.ondetached == \"function\" ? callbacks.ondetached : Janus.noop;\r\n    if (!connected) {\r\n      Janus.warn(\"Is the gateway down? (connected=false)\");\r\n      callbacks.error(\"Is the gateway down? (connected=false)\");\r\n      return;\r\n    }\r\n    var plugin = callbacks.plugin;\r\n    if (plugin === undefined || plugin === null) {\r\n      Janus.error(\"Invalid plugin\");\r\n      callbacks.error(\"Invalid plugin\");\r\n      return;\r\n    }\r\n    var opaqueId = callbacks.opaqueId;\r\n    var transaction = Janus.randomString(12);\r\n    var request = {\r\n      janus: \"attach\",\r\n      plugin: plugin,\r\n      opaque_id: opaqueId,\r\n      transaction: transaction,\r\n    };\r\n    if (token !== null && token !== undefined) request[\"token\"] = token;\r\n    if (apisecret !== null && apisecret !== undefined) request[\"apisecret\"] = apisecret;\r\n    // If we know the browser supports BUNDLE and/or rtcp-mux, let's advertise those right away\r\n    if (adapter.browserDetails.browser == \"chrome\" || adapter.browserDetails.browser == \"firefox\") {\r\n      request[\"force-bundle\"] = true;\r\n      request[\"force-rtcp-mux\"] = true;\r\n    }\r\n    if (websockets) {\r\n      transactions[transaction] = function (json) {\r\n        Janus.debug(json);\r\n        if (json[\"janus\"] !== \"success\") {\r\n          Janus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason); // FIXME\r\n          callbacks.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\r\n          return;\r\n        }\r\n        var handleId = json.data[\"id\"];\r\n        Janus.log(\"Created handle: \" + handleId);\r\n        var pluginHandle = {\r\n          session: that,\r\n          plugin: plugin,\r\n          id: handleId,\r\n          detached: false,\r\n          webrtcStuff: {\r\n            started: false,\r\n            myStream: null,\r\n            streamExternal: false,\r\n            remoteStream: null,\r\n            mySdp: null,\r\n            pc: null,\r\n            dataChannel: null,\r\n            dtmfSender: null,\r\n            trickle: true,\r\n            iceDone: false,\r\n            sdpSent: false,\r\n            volume: {\r\n              value: null,\r\n              timer: null,\r\n            },\r\n            bitrate: {\r\n              value: null,\r\n              bsnow: null,\r\n              bsbefore: null,\r\n              tsnow: null,\r\n              tsbefore: null,\r\n              timer: null,\r\n            },\r\n          },\r\n          getId: function () {\r\n            return handleId;\r\n          },\r\n          getPlugin: function () {\r\n            return plugin;\r\n          },\r\n          getVolume: function () {\r\n            return getVolume(handleId);\r\n          },\r\n          isAudioMuted: function () {\r\n            return isMuted(handleId, false);\r\n          },\r\n          muteAudio: function () {\r\n            return mute(handleId, false, true);\r\n          },\r\n          unmuteAudio: function () {\r\n            return mute(handleId, false, false);\r\n          },\r\n          isVideoMuted: function () {\r\n            return isMuted(handleId, true);\r\n          },\r\n          muteVideo: function () {\r\n            return mute(handleId, true, true);\r\n          },\r\n          unmuteVideo: function () {\r\n            return mute(handleId, true, false);\r\n          },\r\n          getBitrate: function () {\r\n            return getBitrate(handleId);\r\n          },\r\n          send: function (callbacks) {\r\n            sendMessage(handleId, callbacks);\r\n          },\r\n          data: function (callbacks) {\r\n            sendData(handleId, callbacks);\r\n          },\r\n          dtmf: function (callbacks) {\r\n            sendDtmf(handleId, callbacks);\r\n          },\r\n          consentDialog: callbacks.consentDialog,\r\n          iceState: callbacks.iceState,\r\n          mediaState: callbacks.mediaState,\r\n          webrtcState: callbacks.webrtcState,\r\n          slowLink: callbacks.slowLink,\r\n          onmessage: callbacks.onmessage,\r\n          createOffer: function (callbacks) {\r\n            prepareWebrtc(handleId, callbacks);\r\n          },\r\n          createAnswer: function (callbacks) {\r\n            prepareWebrtc(handleId, callbacks);\r\n          },\r\n          handleRemoteJsep: function (callbacks) {\r\n            prepareWebrtcPeer(handleId, callbacks);\r\n          },\r\n          onlocalstream: callbacks.onlocalstream,\r\n          onremotestream: callbacks.onremotestream,\r\n          ondata: callbacks.ondata,\r\n          ondataopen: callbacks.ondataopen,\r\n          oncleanup: callbacks.oncleanup,\r\n          ondetached: callbacks.ondetached,\r\n          hangup: function (sendRequest) {\r\n            cleanupWebrtc(handleId, sendRequest === true);\r\n          },\r\n          detach: function (callbacks) {\r\n            destroyHandle(handleId, callbacks);\r\n          },\r\n        };\r\n        pluginHandles[handleId] = pluginHandle;\r\n        callbacks.success(pluginHandle);\r\n      };\r\n      request[\"session_id\"] = sessionId;\r\n      console.log(\"||||||\", request);\r\n      ws.send(JSON.stringify(request));\r\n      return;\r\n    }\r\n    Janus.ajax({\r\n      type: \"POST\",\r\n      url: server + \"/\" + sessionId,\r\n      withCredentials: withCredentials,\r\n      cache: false,\r\n      contentType: \"application/json\",\r\n      data: JSON.stringify(request),\r\n      success: function (json) {\r\n        Janus.debug(json);\r\n        if (json[\"janus\"] !== \"success\") {\r\n          Janus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason); // FIXME\r\n          callbacks.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason);\r\n          return;\r\n        }\r\n        var handleId = json.data[\"id\"];\r\n        Janus.log(\"Created handle: \" + handleId);\r\n        var pluginHandle = {\r\n          session: that,\r\n          plugin: plugin,\r\n          id: handleId,\r\n          detached: false,\r\n          webrtcStuff: {\r\n            started: false,\r\n            myStream: null,\r\n            streamExternal: false,\r\n            remoteStream: null,\r\n            mySdp: null,\r\n            pc: null,\r\n            dataChannel: null,\r\n            dtmfSender: null,\r\n            trickle: true,\r\n            iceDone: false,\r\n            sdpSent: false,\r\n            volume: {\r\n              value: null,\r\n              timer: null,\r\n            },\r\n            bitrate: {\r\n              value: null,\r\n              bsnow: null,\r\n              bsbefore: null,\r\n              tsnow: null,\r\n              tsbefore: null,\r\n              timer: null,\r\n            },\r\n          },\r\n          getId: function () {\r\n            return handleId;\r\n          },\r\n          getPlugin: function () {\r\n            return plugin;\r\n          },\r\n          getVolume: function () {\r\n            return getVolume(handleId);\r\n          },\r\n          isAudioMuted: function () {\r\n            return isMuted(handleId, false);\r\n          },\r\n          muteAudio: function () {\r\n            return mute(handleId, false, true);\r\n          },\r\n          unmuteAudio: function () {\r\n            return mute(handleId, false, false);\r\n          },\r\n          isVideoMuted: function () {\r\n            return isMuted(handleId, true);\r\n          },\r\n          muteVideo: function () {\r\n            return mute(handleId, true, true);\r\n          },\r\n          unmuteVideo: function () {\r\n            return mute(handleId, true, false);\r\n          },\r\n          getBitrate: function () {\r\n            return getBitrate(handleId);\r\n          },\r\n          send: function (callbacks) {\r\n            sendMessage(handleId, callbacks);\r\n          },\r\n          data: function (callbacks) {\r\n            sendData(handleId, callbacks);\r\n          },\r\n          dtmf: function (callbacks) {\r\n            sendDtmf(handleId, callbacks);\r\n          },\r\n          consentDialog: callbacks.consentDialog,\r\n          iceState: callbacks.iceState,\r\n          mediaState: callbacks.mediaState,\r\n          webrtcState: callbacks.webrtcState,\r\n          slowLink: callbacks.slowLink,\r\n          onmessage: callbacks.onmessage,\r\n          createOffer: function (callbacks) {\r\n            prepareWebrtc(handleId, callbacks);\r\n          },\r\n          createAnswer: function (callbacks) {\r\n            prepareWebrtc(handleId, callbacks);\r\n          },\r\n          handleRemoteJsep: function (callbacks) {\r\n            prepareWebrtcPeer(handleId, callbacks);\r\n          },\r\n          onlocalstream: callbacks.onlocalstream,\r\n          onremotestream: callbacks.onremotestream,\r\n          ondata: callbacks.ondata,\r\n          ondataopen: callbacks.ondataopen,\r\n          oncleanup: callbacks.oncleanup,\r\n          ondetached: callbacks.ondetached,\r\n          hangup: function (sendRequest) {\r\n            cleanupWebrtc(handleId, sendRequest === true);\r\n          },\r\n          detach: function (callbacks) {\r\n            destroyHandle(handleId, callbacks);\r\n          },\r\n        };\r\n        pluginHandles[handleId] = pluginHandle;\r\n        callbacks.success(pluginHandle);\r\n      },\r\n      error: function (XMLHttpRequest, textStatus, errorThrown) {\r\n        Janus.error(textStatus + \": \" + errorThrown); // FIXME\r\n      },\r\n      dataType: \"json\",\r\n    });\r\n  }\r\n\r\n  // Private method to send a message\r\n  function sendMessage(handleId, callbacks) {\r\n    callbacks = callbacks || {};\r\n    callbacks.success = typeof callbacks.success == \"function\" ? callbacks.success : Janus.noop;\r\n    callbacks.error = typeof callbacks.error == \"function\" ? callbacks.error : Janus.noop;\r\n    if (!connected) {\r\n      Janus.warn(\"Is the gateway down? (connected=false)\");\r\n      callbacks.error(\"Is the gateway down? (connected=false)\");\r\n      return;\r\n    }\r\n    var message = callbacks.message;\r\n    var jsep = callbacks.jsep;\r\n    var transaction = Janus.randomString(12);\r\n    var request = { janus: \"message\", body: message, transaction: transaction };\r\n    if (token !== null && token !== undefined) request[\"token\"] = token;\r\n    if (apisecret !== null && apisecret !== undefined) request[\"apisecret\"] = apisecret;\r\n    if (jsep !== null && jsep !== undefined) request.jsep = jsep;\r\n    Janus.debug(\"Sending message to plugin (handle=\" + handleId + \"):\");\r\n    Janus.debug(request);\r\n    if (websockets) {\r\n      request[\"session_id\"] = sessionId;\r\n      request[\"handle_id\"] = handleId;\r\n      transactions[transaction] = function (json) {\r\n        Janus.debug(\"Message sent!\");\r\n        Janus.debug(json);\r\n        if (json[\"janus\"] === \"success\") {\r\n          // We got a success, must have been a synchronous transaction\r\n          var plugindata = json[\"plugindata\"];\r\n          if (plugindata === undefined || plugindata === null) {\r\n            Janus.warn(\"Request succeeded, but missing plugindata...\");\r\n            callbacks.success();\r\n            return;\r\n          }\r\n          Janus.log(\"Synchronous transaction successful (\" + plugindata[\"plugin\"] + \")\");\r\n          var data = plugindata[\"data\"];\r\n          Janus.debug(data);\r\n          callbacks.success(data);\r\n          return;\r\n        } else if (json[\"janus\"] !== \"ack\") {\r\n          // Not a success and not an ack, must be an error\r\n          if (json[\"error\"] !== undefined && json[\"error\"] !== null) {\r\n            Janus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason); // FIXME\r\n            callbacks.error(json[\"error\"].code + \" \" + json[\"error\"].reason);\r\n          } else {\r\n            Janus.error(\"Unknown error\"); // FIXME\r\n            callbacks.error(\"Unknown error\");\r\n          }\r\n          return;\r\n        }\r\n        // If we got here, the plugin decided to handle the request asynchronously\r\n        callbacks.success();\r\n      };\r\n      console.log(\"~~~~~~\", request);\r\n      ws.send(JSON.stringify(request));\r\n      return;\r\n    }\r\n    Janus.ajax({\r\n      type: \"POST\",\r\n      url: server + \"/\" + sessionId + \"/\" + handleId,\r\n      withCredentials: withCredentials,\r\n      cache: false,\r\n      contentType: \"application/json\",\r\n      data: JSON.stringify(request),\r\n      success: function (json) {\r\n        Janus.debug(\"Message sent!\");\r\n        Janus.debug(json);\r\n        if (json[\"janus\"] === \"success\") {\r\n          // We got a success, must have been a synchronous transaction\r\n          var plugindata = json[\"plugindata\"];\r\n          if (plugindata === undefined || plugindata === null) {\r\n            Janus.warn(\"Request succeeded, but missing plugindata...\");\r\n            callbacks.success();\r\n            return;\r\n          }\r\n          Janus.log(\"Synchronous transaction successful (\" + plugindata[\"plugin\"] + \")\");\r\n          var data = plugindata[\"data\"];\r\n          Janus.debug(data);\r\n          callbacks.success(data);\r\n          return;\r\n        } else if (json[\"janus\"] !== \"ack\") {\r\n          // Not a success and not an ack, must be an error\r\n          if (json[\"error\"] !== undefined && json[\"error\"] !== null) {\r\n            Janus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason); // FIXME\r\n            callbacks.error(json[\"error\"].code + \" \" + json[\"error\"].reason);\r\n          } else {\r\n            Janus.error(\"Unknown error\"); // FIXME\r\n            callbacks.error(\"Unknown error\");\r\n          }\r\n          return;\r\n        }\r\n        // If we got here, the plugin decided to handle the request asynchronously\r\n        callbacks.success();\r\n      },\r\n      error: function (XMLHttpRequest, textStatus, errorThrown) {\r\n        Janus.error(textStatus + \": \" + errorThrown); // FIXME\r\n        callbacks.error(textStatus + \": \" + errorThrown);\r\n      },\r\n      dataType: \"json\",\r\n    });\r\n  }\r\n\r\n  // Private method to send a trickle candidate\r\n  function sendTrickleCandidate(handleId, candidate) {\r\n    if (!connected) {\r\n      Janus.warn(\"Is the gateway down? (connected=false)\");\r\n      return;\r\n    }\r\n    var request = { janus: \"trickle\", candidate: candidate, transaction: Janus.randomString(12) };\r\n    if (token !== null && token !== undefined) request[\"token\"] = token;\r\n    if (apisecret !== null && apisecret !== undefined) request[\"apisecret\"] = apisecret;\r\n    Janus.vdebug(\"Sending trickle candidate (handle=\" + handleId + \"):\");\r\n    Janus.vdebug(request);\r\n    if (websockets) {\r\n      request[\"session_id\"] = sessionId;\r\n      request[\"handle_id\"] = handleId;\r\n      ws.send(JSON.stringify(request));\r\n      return;\r\n    }\r\n    Janus.ajax({\r\n      type: \"POST\",\r\n      url: server + \"/\" + sessionId + \"/\" + handleId,\r\n      withCredentials: withCredentials,\r\n      cache: false,\r\n      contentType: \"application/json\",\r\n      data: JSON.stringify(request),\r\n      success: function (json) {\r\n        Janus.vdebug(\"Candidate sent!\");\r\n        Janus.vdebug(json);\r\n        if (json[\"janus\"] !== \"ack\") {\r\n          Janus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason); // FIXME\r\n          return;\r\n        }\r\n      },\r\n      error: function (XMLHttpRequest, textStatus, errorThrown) {\r\n        Janus.error(textStatus + \": \" + errorThrown); // FIXME\r\n      },\r\n      dataType: \"json\",\r\n    });\r\n  }\r\n\r\n  // Private method to send a data channel message\r\n  function sendData(handleId, callbacks) {\r\n    callbacks = callbacks || {};\r\n    callbacks.success = typeof callbacks.success == \"function\" ? callbacks.success : Janus.noop;\r\n    callbacks.error = typeof callbacks.error == \"function\" ? callbacks.error : Janus.noop;\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (\r\n      pluginHandle === null ||\r\n      pluginHandle === undefined ||\r\n      pluginHandle.webrtcStuff === null ||\r\n      pluginHandle.webrtcStuff === undefined\r\n    ) {\r\n      Janus.warn(\"Invalid handle\");\r\n      \r\n      callbacks.error(\"Invalid handle\");\r\n      return;\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    var text = callbacks.text;\r\n    if (text === null || text === undefined) {\r\n      Janus.warn(\"Invalid text\");\r\n      callbacks.error(\"Invalid text\");\r\n      return;\r\n    }\r\n    Janus.log(\"Sending string on data channel: \" + text);\r\n    config.dataChannel.send(text);\r\n    callbacks.success();\r\n  }\r\n\r\n  // Private method to send a DTMF tone\r\n  function sendDtmf(handleId, callbacks) {\r\n    callbacks = callbacks || {};\r\n    callbacks.success = typeof callbacks.success == \"function\" ? callbacks.success : Janus.noop;\r\n    callbacks.error = typeof callbacks.error == \"function\" ? callbacks.error : Janus.noop;\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (\r\n      pluginHandle === null ||\r\n      pluginHandle === undefined ||\r\n      pluginHandle.webrtcStuff === null ||\r\n      pluginHandle.webrtcStuff === undefined\r\n    ) {\r\n      Janus.warn(\"Invalid handle\");\r\n      callbacks.error(\"Invalid handle\");\r\n      return;\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    if (config.dtmfSender === null || config.dtmfSender === undefined) {\r\n      // Create the DTMF sender, if possible\r\n      if (config.myStream !== undefined && config.myStream !== null) {\r\n        var tracks = config.myStream.getAudioTracks();\r\n        if (tracks !== null && tracks !== undefined && tracks.length > 0) {\r\n          var local_audio_track = tracks[0];\r\n          config.dtmfSender = config.pc.createDTMFSender(local_audio_track);\r\n          Janus.log(\"Created DTMF Sender\");\r\n          config.dtmfSender.ontonechange = function (tone) {\r\n            Janus.debug(\"Sent DTMF tone: \" + tone.tone);\r\n          };\r\n        }\r\n      }\r\n      if (config.dtmfSender === null || config.dtmfSender === undefined) {\r\n        Janus.warn(\"Invalid DTMF configuration\");\r\n        callbacks.error(\"Invalid DTMF configuration\");\r\n        return;\r\n      }\r\n    }\r\n    var dtmf = callbacks.dtmf;\r\n    if (dtmf === null || dtmf === undefined) {\r\n      Janus.warn(\"Invalid DTMF parameters\");\r\n      callbacks.error(\"Invalid DTMF parameters\");\r\n      return;\r\n    }\r\n    var tones = dtmf.tones;\r\n    if (tones === null || tones === undefined) {\r\n      Janus.warn(\"Invalid DTMF string\");\r\n      callbacks.error(\"Invalid DTMF string\");\r\n      return;\r\n    }\r\n    var duration = dtmf.duration;\r\n    if (duration === null || duration === undefined) duration = 500; // We choose 500ms as the default duration for a tone\r\n    var gap = dtmf.gap;\r\n    if (gap === null || gap === undefined) gap = 50; // We choose 50ms as the default gap between tones\r\n    Janus.debug(\r\n      \"Sending DTMF string \" + tones + \" (duration \" + duration + \"ms, gap \" + gap + \"ms)\"\r\n    );\r\n    config.dtmfSender.insertDTMF(tones, duration, gap);\r\n  }\r\n\r\n  // Private method to destroy a plugin handle\r\n  function destroyHandle(handleId, callbacks) {\r\n    callbacks = callbacks || {};\r\n    callbacks.success = typeof callbacks.success == \"function\" ? callbacks.success : Janus.noop;\r\n    callbacks.error = typeof callbacks.error == \"function\" ? callbacks.error : Janus.noop;\r\n    var asyncRequest = true;\r\n    if (callbacks.asyncRequest !== undefined && callbacks.asyncRequest !== null)\r\n      asyncRequest = callbacks.asyncRequest === true;\r\n    Janus.log(\"Destroying handle \" + handleId + \" (sync=\" + asyncRequest + \")\");\r\n    cleanupWebrtc(handleId);\r\n    if (pluginHandles[handleId].detached) {\r\n      // Plugin was already detached by Janus, calling detach again will return a handle not found error, so just exit here\r\n      delete pluginHandles[handleId];\r\n      callbacks.success();\r\n      return;\r\n    }\r\n    if (!connected) {\r\n      Janus.warn(\"Is the gateway down? (connected=false)\");\r\n      callbacks.error(\"Is the gateway down? (connected=false)\");\r\n      return;\r\n    }\r\n    var request = { janus: \"detach\", transaction: Janus.randomString(12) };\r\n    if (token !== null && token !== undefined) request[\"token\"] = token;\r\n    if (apisecret !== null && apisecret !== undefined) request[\"apisecret\"] = apisecret;\r\n    if (websockets) {\r\n      request[\"session_id\"] = sessionId;\r\n      request[\"handle_id\"] = handleId;\r\n      ws.send(JSON.stringify(request));\r\n      delete pluginHandles[handleId];\r\n      callbacks.success();\r\n      return;\r\n    }\r\n    Janus.ajax({\r\n      type: \"POST\",\r\n      url: server + \"/\" + sessionId + \"/\" + handleId,\r\n      async: asyncRequest, // Sometimes we need false here, or destroying in onbeforeunload won't work\r\n      withCredentials: withCredentials,\r\n      cache: false,\r\n      contentType: \"application/json\",\r\n      data: JSON.stringify(request),\r\n      success: function (json) {\r\n        Janus.log(\"Destroyed handle:\");\r\n        Janus.debug(json);\r\n        if (json[\"janus\"] !== \"success\") {\r\n          Janus.error(\"Ooops: \" + json[\"error\"].code + \" \" + json[\"error\"].reason); // FIXME\r\n        }\r\n        delete pluginHandles[handleId];\r\n        callbacks.success();\r\n      },\r\n      error: function (XMLHttpRequest, textStatus, errorThrown) {\r\n        Janus.error(textStatus + \": \" + errorThrown); // FIXME\r\n        // We cleanup anyway\r\n        delete pluginHandles[handleId];\r\n        callbacks.success();\r\n      },\r\n      dataType: \"json\",\r\n    });\r\n  }\r\n\r\n  // WebRTC stuff\r\n  function streamsDone(handleId, jsep, media, callbacks, stream) {\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (\r\n      pluginHandle === null ||\r\n      pluginHandle === undefined ||\r\n      pluginHandle.webrtcStuff === null ||\r\n      pluginHandle.webrtcStuff === undefined\r\n    ) {\r\n      Janus.warn(\"Invalid handle\");\r\n      callbacks.error(\"Invalid handle\");\r\n      return;\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    Janus.debug(\"streamsDone:\", stream);\r\n    config.myStream = stream;\r\n    var pc_config = { iceServers: iceServers, iceTransportPolicy: iceTransportPolicy };\r\n    //~ var pc_constraints = {'mandatory': {'MozDontOfferDataChannel':true}};\r\n    var pc_constraints = {\r\n      optional: [{ DtlsSrtpKeyAgreement: true }],\r\n    };\r\n    if (ipv6Support === true) {\r\n      // FIXME This is only supported in Chrome right now\r\n      // For support in Firefox track this: https://bugzilla.mozilla.org/show_bug.cgi?id=797262\r\n      pc_constraints.optional.push({ googIPv6: true });\r\n    }\r\n    if (adapter.browserDetails.browser === \"edge\") {\r\n      // This is Edge, enable BUNDLE explicitly\r\n      pc_config.bundlePolicy = \"max-bundle\";\r\n    }\r\n    Janus.log(\"Creating PeerConnection\");\r\n    Janus.debug(pc_constraints);\r\n    config.pc = new RTCPeerConnection(pc_config, pc_constraints);\r\n    Janus.debug(config.pc);\r\n    if (config.pc.getStats) {\r\n      // FIXME\r\n      config.volume.value = 0;\r\n      config.bitrate.value = \"0 kbits/sec\";\r\n    }\r\n    Janus.log(\"Preparing local SDP and gathering candidates (trickle=\" + config.trickle + \")\");\r\n    config.pc.oniceconnectionstatechange = function (e) {\r\n      if (config.pc) pluginHandle.iceState(config.pc.iceConnectionState);\r\n    };\r\n    config.pc.onicecandidate = function (event) {\r\n      if (\r\n        event.candidate == null ||\r\n        (adapter.browserDetails.browser === \"edge\" &&\r\n          event.candidate.candidate.indexOf(\"endOfCandidates\") > 0)\r\n      ) {\r\n        Janus.log(\"End of candidates.\");\r\n        config.iceDone = true;\r\n        if (config.trickle === true) {\r\n          // Notify end of candidates\r\n          sendTrickleCandidate(handleId, { completed: true });\r\n        } else {\r\n          // No trickle, time to send the complete SDP (including all candidates)\r\n          sendSDP(handleId, callbacks);\r\n        }\r\n      } else {\r\n        // JSON.stringify doesn't work on some WebRTC objects anymore\r\n        // See https://code.google.com/p/chromium/issues/detail?id=467366\r\n        var candidate = {\r\n          candidate: event.candidate.candidate,\r\n          sdpMid: event.candidate.sdpMid,\r\n          sdpMLineIndex: event.candidate.sdpMLineIndex,\r\n        };\r\n        if (config.trickle === true) {\r\n          // Send candidate\r\n          sendTrickleCandidate(handleId, candidate);\r\n        }\r\n      }\r\n    };\r\n    if (stream !== null && stream !== undefined) {\r\n      Janus.log(\"Adding local stream\");\r\n      config.pc.addStream(stream);\r\n      pluginHandle.onlocalstream(stream);\r\n    }\r\n    config.pc.onaddstream = function (remoteStream) {\r\n      Janus.log(\"Handling Remote Stream\");\r\n      Janus.debug(remoteStream);\r\n      config.remoteStream = remoteStream;\r\n      pluginHandle.onremotestream(remoteStream.stream);\r\n    };\r\n    // Any data channel to create?\r\n    if (isDataEnabled(media)) {\r\n      Janus.log(\"Creating data channel\");\r\n      var onDataChannelMessage = function (event) {\r\n        Janus.log(\"Received message on data channel: \" + event.data);\r\n        pluginHandle.ondata(event.data); // FIXME\r\n      };\r\n      var onDataChannelStateChange = function () {\r\n        var dcState = config.dataChannel !== null ? config.dataChannel.readyState : \"null\";\r\n        Janus.log(\"State change on data channel: \" + dcState);\r\n        if (dcState === \"open\") {\r\n          pluginHandle.ondataopen(); // FIXME\r\n        }\r\n      };\r\n      var onDataChannelError = function (error) {\r\n        Janus.error(\"Got error on data channel:\", error);\r\n        // TODO\r\n      };\r\n      // Until we implement the proxying of open requests within the Janus core, we open a channel ourselves whatever the case\r\n      config.dataChannel = config.pc.createDataChannel(\"JanusDataChannel\", { ordered: false }); // FIXME Add options (ordered, maxRetransmits, etc.)\r\n      config.dataChannel.onmessage = onDataChannelMessage;\r\n      config.dataChannel.onopen = onDataChannelStateChange;\r\n      config.dataChannel.onclose = onDataChannelStateChange;\r\n      config.dataChannel.onerror = onDataChannelError;\r\n    }\r\n    // Create offer/answer now\r\n    if (jsep === null || jsep === undefined) {\r\n      createOffer(handleId, media, callbacks);\r\n    } else {\r\n      if (adapter.browserDetails.browser === \"edge\") {\r\n        // This is Edge, add an a=end-of-candidates at the end\r\n        jsep.sdp += \"a=end-of-candidates\\r\\n\";\r\n      }\r\n      config.pc.setRemoteDescription(\r\n        new RTCSessionDescription(jsep),\r\n        function () {\r\n          Janus.log(\"Remote description accepted!\");\r\n          createAnswer(handleId, media, callbacks);\r\n        },\r\n        callbacks.error\r\n      );\r\n    }\r\n  }\r\n\r\n  function prepareWebrtc(handleId, callbacks) {\r\n    callbacks = callbacks || {};\r\n    callbacks.success = typeof callbacks.success == \"function\" ? callbacks.success : Janus.noop;\r\n    callbacks.error = typeof callbacks.error == \"function\" ? callbacks.error : webrtcError;\r\n    var jsep = callbacks.jsep;\r\n    var media = callbacks.media;\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (\r\n      pluginHandle === null ||\r\n      pluginHandle === undefined ||\r\n      pluginHandle.webrtcStuff === null ||\r\n      pluginHandle.webrtcStuff === undefined\r\n    ) {\r\n      Janus.warn(\"Invalid handle\");\r\n      callbacks.error(\"Invalid handle\");\r\n      return;\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    // Are we updating a session?\r\n    if (config.pc !== undefined && config.pc !== null) {\r\n      Janus.log(\"Updating existing media session\");\r\n      // Create offer/answer now\r\n      if (jsep === null || jsep === undefined) {\r\n        createOffer(handleId, media, callbacks);\r\n      } else {\r\n        if (adapter.browserDetails.browser === \"edge\") {\r\n          // This is Edge, add an a=end-of-candidates at the end\r\n          jsep.sdp += \"a=end-of-candidates\\r\\n\";\r\n        }\r\n        config.pc.setRemoteDescription(\r\n          new RTCSessionDescription(jsep),\r\n          function () {\r\n            Janus.log(\"Remote description accepted!\");\r\n            createAnswer(handleId, media, callbacks);\r\n          },\r\n          callbacks.error\r\n        );\r\n      }\r\n      return;\r\n    }\r\n    // Was a MediaStream object passed, or do we need to take care of that?\r\n    if (callbacks.stream !== null && callbacks.stream !== undefined) {\r\n      var stream = callbacks.stream;\r\n      Janus.log(\"MediaStream provided by the application\");\r\n      Janus.debug(stream);\r\n      // Skip the getUserMedia part\r\n      config.streamExternal = true;\r\n      streamsDone(handleId, jsep, media, callbacks, stream);\r\n      return;\r\n    }\r\n    config.trickle = isTrickleEnabled(callbacks.trickle);\r\n    if (isAudioSendEnabled(media) || isVideoSendEnabled(media)) {\r\n      var constraints = { mandatory: {}, optional: [] };\r\n      pluginHandle.consentDialog(true);\r\n      var audioSupport = isAudioSendEnabled(media);\r\n      if (audioSupport === true && media != undefined && media != null) {\r\n        if (typeof media.audio === \"object\") {\r\n          audioSupport = media.audio;\r\n        }\r\n      }\r\n      var videoSupport = isVideoSendEnabled(media);\r\n      if (videoSupport === true && media != undefined && media != null) {\r\n        if (media.video && media.video != \"screen\" && media.video != \"window\") {\r\n          var width = 0;\r\n          var height = 0,\r\n            maxHeight = 0;\r\n          if (media.video === \"lowres\") {\r\n            // Small resolution, 4:3\r\n            height = 240;\r\n            maxHeight = 240;\r\n            width = 320;\r\n          } else if (media.video === \"lowres-16:9\") {\r\n            // Small resolution, 16:9\r\n            height = 180;\r\n            maxHeight = 180;\r\n            width = 320;\r\n          } else if (media.video === \"hires\" || media.video === \"hires-16:9\") {\r\n            // High resolution is only 16:9\r\n            height = 720;\r\n            maxHeight = 720;\r\n            width = 1280;\r\n            if (navigator.mozGetUserMedia) {\r\n              var firefoxVer = parseInt(window.navigator.userAgent.match(/Firefox\\/(.*)/)[1], 10);\r\n              if (firefoxVer < 38) {\r\n                // Unless this is and old Firefox, which doesn't support it\r\n                Janus.warn(media.video + \" unsupported, falling back to stdres (old Firefox)\");\r\n                height = 480;\r\n                maxHeight = 480;\r\n                width = 640;\r\n              }\r\n            }\r\n          } else if (media.video === \"stdres\") {\r\n            // Normal resolution, 4:3\r\n            height = 480;\r\n            maxHeight = 480;\r\n            width = 640;\r\n          } else if (media.video === \"stdres-16:9\") {\r\n            // Normal resolution, 16:9\r\n            height = 360;\r\n            maxHeight = 360;\r\n            width = 640;\r\n          } else {\r\n            Janus.log(\"Default video setting (\" + media.video + \") is stdres 4:3\");\r\n            height = 480;\r\n            maxHeight = 480;\r\n            width = 640;\r\n          }\r\n          Janus.log(\"Adding media constraint \" + media.video);\r\n          if (navigator.mozGetUserMedia) {\r\n            var firefoxVer = parseInt(window.navigator.userAgent.match(/Firefox\\/(.*)/)[1], 10);\r\n            if (firefoxVer < 38) {\r\n              videoSupport = {\r\n                require: [\"height\", \"width\"],\r\n                height: { max: maxHeight, min: height },\r\n                width: { max: width, min: width },\r\n              };\r\n            } else {\r\n              // http://stackoverflow.com/questions/28282385/webrtc-firefox-constraints/28911694#28911694\r\n              // https://github.com/meetecho/janus-gateway/pull/246\r\n              videoSupport = {\r\n                height: { ideal: height },\r\n                width: { ideal: width },\r\n              };\r\n            }\r\n          } else {\r\n            videoSupport = {\r\n              mandatory: {\r\n                maxHeight: maxHeight,\r\n                minHeight: height,\r\n                maxWidth: width,\r\n                minWidth: width,\r\n              },\r\n              optional: [],\r\n            };\r\n          }\r\n          if (typeof media.video === \"object\") {\r\n            videoSupport = media.video;\r\n          }\r\n          Janus.debug(videoSupport);\r\n        } else if (media.video === \"screen\" || media.video === \"window\") {\r\n          if (!media.screenshareFrameRate) {\r\n            media.screenshareFrameRate = 3;\r\n          }\r\n          // Not a webcam, but screen capture\r\n          if (window.location.protocol !== \"https:\") {\r\n            // Screen sharing mandates HTTPS\r\n            Janus.warn(\"Screen sharing only works on HTTPS, try the https:// version of this page\");\r\n            pluginHandle.consentDialog(false);\r\n            callbacks.error(\r\n              \"Screen sharing only works on HTTPS, try the https:// version of this page\"\r\n            );\r\n            return;\r\n          }\r\n          // We're going to try and use the extension for Chrome 34+, the old approach\r\n          // for older versions of Chrome, or the experimental support in Firefox 33+\r\n          var cache = {};\r\n          function callbackUserMedia(error, stream) {\r\n            pluginHandle.consentDialog(false);\r\n            if (error) {\r\n              callbacks.error({ code: error.code, name: error.name, message: error.message });\r\n            } else {\r\n              streamsDone(handleId, jsep, media, callbacks, stream);\r\n            }\r\n          }\r\n          function getScreenMedia(constraints, gsmCallback, useAudio) {\r\n            Janus.log(\"Adding media constraint (screen capture)\");\r\n            Janus.debug(constraints);\r\n            navigator.mediaDevices\r\n              .getUserMedia(constraints)\r\n              .then(function (stream) {\r\n                if (useAudio) {\r\n                  navigator.mediaDevices\r\n                    .getUserMedia({ audio: true, video: false })\r\n                    .then(function (audioStream) {\r\n                      stream.addTrack(audioStream.getAudioTracks()[0]);\r\n                      gsmCallback(null, stream);\r\n                    });\r\n                } else {\r\n                  gsmCallback(null, stream);\r\n                }\r\n              })\r\n              .catch(function (error) {\r\n                pluginHandle.consentDialog(false);\r\n                gsmCallback(error);\r\n              });\r\n          }\r\n          if (adapter.browserDetails.browser === \"chrome\") {\r\n            var chromever = adapter.browserDetails.version;\r\n            var maxver = 33;\r\n            if (window.navigator.userAgent.match(\"Linux\")) maxver = 35; // \"known\" crash in chrome 34 and 35 on linux\r\n            if (chromever >= 26 && chromever <= maxver) {\r\n              // Chrome 26->33 requires some awkward chrome://flags manipulation\r\n              constraints = {\r\n                video: {\r\n                  mandatory: {\r\n                    googLeakyBucket: true,\r\n                    maxWidth: window.screen.width,\r\n                    maxHeight: window.screen.height,\r\n                    minFrameRate: media.screenshareFrameRate,\r\n                    maxFrameRate: media.screenshareFrameRate,\r\n                    chromeMediaSource: \"screen\",\r\n                  },\r\n                },\r\n                audio: isAudioSendEnabled(media),\r\n              };\r\n              getScreenMedia(constraints, callbackUserMedia);\r\n            } else {\r\n              // Chrome 34+ requires an extension\r\n              var pending = window.setTimeout(function () {\r\n                error = new Error(\"NavigatorUserMediaError\");\r\n                error.name =\r\n                  'The required Chrome extension is not installed: click <a href=\"#\">here</a> to install it. (NOTE: this will need you to refresh the page)';\r\n                pluginHandle.consentDialog(false);\r\n                return callbacks.error(error);\r\n              }, 1000);\r\n              cache[pending] = [callbackUserMedia, null];\r\n              window.postMessage({ type: \"janusGetScreen\", id: pending }, \"*\");\r\n            }\r\n          } else if (window.navigator.userAgent.match(\"Firefox\")) {\r\n            var ffver = parseInt(window.navigator.userAgent.match(/Firefox\\/(.*)/)[1], 10);\r\n            if (ffver >= 33) {\r\n              // Firefox 33+ has experimental support for screen sharing\r\n              constraints = {\r\n                video: {\r\n                  mozMediaSource: media.video,\r\n                  mediaSource: media.video,\r\n                },\r\n                audio: isAudioSendEnabled(media),\r\n              };\r\n              getScreenMedia(constraints, function (err, stream) {\r\n                callbackUserMedia(err, stream);\r\n                // Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=1045810\r\n                if (!err) {\r\n                  var lastTime = stream.currentTime;\r\n                  var polly = window.setInterval(function () {\r\n                    if (!stream) window.clearInterval(polly);\r\n                    if (stream.currentTime == lastTime) {\r\n                      window.clearInterval(polly);\r\n                      if (stream.onended) {\r\n                        stream.onended();\r\n                      }\r\n                    }\r\n                    lastTime = stream.currentTime;\r\n                  }, 500);\r\n                }\r\n              });\r\n            } else {\r\n              var error = new Error(\"NavigatorUserMediaError\");\r\n              error.name =\r\n                \"Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)\";\r\n              pluginHandle.consentDialog(false);\r\n              callbacks.error(error);\r\n              return;\r\n            }\r\n          }\r\n\r\n          // Wait for events from the Chrome Extension\r\n          window.addEventListener(\"message\", function (event) {\r\n            if (event.origin != window.location.origin) return;\r\n            if (event.data.type == \"janusGotScreen\" && cache[event.data.id]) {\r\n              var data = cache[event.data.id];\r\n              var callback = data[0];\r\n              delete cache[event.data.id];\r\n\r\n              if (event.data.sourceId === \"\") {\r\n                // user canceled\r\n                var error = new Error(\"NavigatorUserMediaError\");\r\n                error.name = \"You cancelled the request for permission, giving up...\";\r\n                pluginHandle.consentDialog(false);\r\n                callbacks.error(error);\r\n              } else {\r\n                constraints = {\r\n                  audio: true,\r\n                  video: {\r\n                    mandatory: {\r\n                      chromeMediaSource: \"desktop\",\r\n                      maxWidth: window.screen.width,\r\n                      maxHeight: window.screen.height,\r\n                      minFrameRate: media.screenshareFrameRate,\r\n                      maxFrameRate: media.screenshareFrameRate,\r\n                    },\r\n                    optional: [{ googLeakyBucket: true }, { googTemporalLayeredScreencast: true }],\r\n                  },\r\n                };\r\n                constraints.video.mandatory.chromeMediaSourceId = event.data.sourceId;\r\n                getScreenMedia(constraints, callback, isAudioSendEnabled(media));\r\n              }\r\n            } else if (event.data.type == \"janusGetScreenPending\") {\r\n              window.clearTimeout(event.data.id);\r\n            }\r\n          });\r\n          return;\r\n        }\r\n      }\r\n      // If we got here, we're not screensharing\r\n      if (media === null || media === undefined || media.video !== \"screen\") {\r\n        // Check whether all media sources are actually available or not\r\n        navigator.mediaDevices\r\n          .enumerateDevices()\r\n          .then(function (devices) {\r\n            var audioExist = devices.some(function (device) {\r\n                return device.kind === \"audioinput\";\r\n              }),\r\n              videoExist = devices.some(function (device) {\r\n                return device.kind === \"videoinput\";\r\n              });\r\n\r\n            // Check whether a missing device is really a problem\r\n            var audioSend = isAudioSendEnabled(media);\r\n            var videoSend = isVideoSendEnabled(media);\r\n            var needAudioDevice = isAudioSendRequired(media);\r\n            var needVideoDevice = isVideoSendRequired(media);\r\n            if (audioSend || videoSend || needAudioDevice || needVideoDevice) {\r\n              // We need to send either audio or video\r\n              var haveAudioDevice = audioSend ? audioExist : false;\r\n              var haveVideoDevice = videoSend ? videoExist : false;\r\n              if (!haveAudioDevice && !haveVideoDevice) {\r\n                // FIXME Should we really give up, or just assume recvonly for both?\r\n                pluginHandle.consentDialog(false);\r\n                callbacks.error(\"No capture device found\");\r\n                return false;\r\n              } else if (!haveAudioDevice && needAudioDevice) {\r\n                pluginHandle.consentDialog(false);\r\n                callbacks.error(\"Audio capture is required, but no capture device found\");\r\n                return false;\r\n              } else if (!haveVideoDevice && needVideoDevice) {\r\n                pluginHandle.consentDialog(false);\r\n                callbacks.error(\"Video capture is required, but no capture device found\");\r\n                return false;\r\n              }\r\n            }\r\n\r\n            navigator.mediaDevices\r\n              .getUserMedia({\r\n                audio: audioExist ? audioSupport : false,\r\n                video: videoExist ? videoSupport : false,\r\n              })\r\n              .then(function (stream) {\r\n                pluginHandle.consentDialog(false);\r\n                streamsDone(handleId, jsep, media, callbacks, stream);\r\n              })\r\n              .catch(function (error) {\r\n                pluginHandle.consentDialog(false);\r\n                callbacks.error({ code: error.code, name: error.name, message: error.message });\r\n              });\r\n          })\r\n          .catch(function (error) {\r\n            pluginHandle.consentDialog(false);\r\n            callbacks.error(\"enumerateDevices error\", error);\r\n          });\r\n      }\r\n    } else {\r\n      // No need to do a getUserMedia, create offer/answer right away\r\n      streamsDone(handleId, jsep, media, callbacks);\r\n    }\r\n  }\r\n\r\n  function prepareWebrtcPeer(handleId, callbacks) {\r\n    callbacks = callbacks || {};\r\n    callbacks.success = typeof callbacks.success == \"function\" ? callbacks.success : Janus.noop;\r\n    callbacks.error = typeof callbacks.error == \"function\" ? callbacks.error : webrtcError;\r\n    var jsep = callbacks.jsep;\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (\r\n      pluginHandle === null ||\r\n      pluginHandle === undefined ||\r\n      pluginHandle.webrtcStuff === null ||\r\n      pluginHandle.webrtcStuff === undefined\r\n    ) {\r\n      Janus.warn(\"Invalid handle\");\r\n      callbacks.error(\"Invalid handle\");\r\n      return;\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    if (jsep !== undefined && jsep !== null) {\r\n      if (config.pc === null) {\r\n        Janus.warn(\r\n          \"Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep\"\r\n        );\r\n        callbacks.error(\r\n          \"No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep\"\r\n        );\r\n        return;\r\n      }\r\n      if (adapter.browserDetails.browser === \"edge\") {\r\n        // This is Edge, add an a=end-of-candidates at the end\r\n        jsep.sdp += \"a=end-of-candidates\\r\\n\";\r\n      }\r\n      config.pc.setRemoteDescription(\r\n        new RTCSessionDescription(jsep),\r\n        function () {\r\n          Janus.log(\"Remote description accepted!\");\r\n          callbacks.success();\r\n        },\r\n        callbacks.error\r\n      );\r\n    } else {\r\n      callbacks.error(\"Invalid JSEP\");\r\n    }\r\n  }\r\n\r\n  function createOffer(handleId, media, callbacks) {\r\n    callbacks = callbacks || {};\r\n    callbacks.success = typeof callbacks.success == \"function\" ? callbacks.success : Janus.noop;\r\n    callbacks.error = typeof callbacks.error == \"function\" ? callbacks.error : Janus.noop;\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (\r\n      pluginHandle === null ||\r\n      pluginHandle === undefined ||\r\n      pluginHandle.webrtcStuff === null ||\r\n      pluginHandle.webrtcStuff === undefined\r\n    ) {\r\n      Janus.warn(\"Invalid handle\");\r\n      callbacks.error(\"Invalid handle\");\r\n      return;\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    Janus.log(\"Creating offer (iceDone=\" + config.iceDone + \")\");\r\n    // https://code.google.com/p/webrtc/issues/detail?id=3508\r\n    var mediaConstraints = null;\r\n    if (adapter.browserDetails.browser == \"firefox\" || adapter.browserDetails.browser == \"edge\") {\r\n      mediaConstraints = {\r\n        offerToReceiveAudio: isAudioRecvEnabled(media),\r\n        offerToReceiveVideo: isVideoRecvEnabled(media),\r\n      };\r\n    } else {\r\n      mediaConstraints = {\r\n        mandatory: {\r\n          OfferToReceiveAudio: isAudioRecvEnabled(media),\r\n          OfferToReceiveVideo: isVideoRecvEnabled(media),\r\n        },\r\n      };\r\n    }\r\n    Janus.debug(mediaConstraints);\r\n    config.pc.createOffer(\r\n      function (offer) {\r\n        Janus.debug(offer);\r\n        if (config.mySdp === null || config.mySdp === undefined) {\r\n          Janus.log(\"Setting local description\");\r\n          config.mySdp = offer.sdp;\r\n          config.pc.setLocalDescription(offer);\r\n        }\r\n        if (!config.iceDone && !config.trickle) {\r\n          // Don't do anything until we have all candidates\r\n          Janus.log(\"Waiting for all candidates...\");\r\n          return;\r\n        }\r\n        if (config.sdpSent) {\r\n          Janus.log(\"Offer already sent, not sending it again\");\r\n          return;\r\n        }\r\n        Janus.log(\"Offer ready\");\r\n        Janus.debug(callbacks);\r\n        config.sdpSent = true;\r\n        // JSON.stringify doesn't work on some WebRTC objects anymore\r\n        // See https://code.google.com/p/chromium/issues/detail?id=467366\r\n        var jsep = {\r\n          type: offer.type,\r\n          sdp: offer.sdp,\r\n        };\r\n        callbacks.success(jsep);\r\n      },\r\n      callbacks.error,\r\n      mediaConstraints\r\n    );\r\n  }\r\n\r\n  function createAnswer(handleId, media, callbacks) {\r\n    callbacks = callbacks || {};\r\n    callbacks.success = typeof callbacks.success == \"function\" ? callbacks.success : Janus.noop;\r\n    callbacks.error = typeof callbacks.error == \"function\" ? callbacks.error : Janus.noop;\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (\r\n      pluginHandle === null ||\r\n      pluginHandle === undefined ||\r\n      pluginHandle.webrtcStuff === null ||\r\n      pluginHandle.webrtcStuff === undefined\r\n    ) {\r\n      Janus.warn(\"Invalid handle\");\r\n      callbacks.error(\"Invalid handle\");\r\n      return;\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    Janus.log(\"Creating answer (iceDone=\" + config.iceDone + \")\");\r\n    var mediaConstraints = null;\r\n    if (adapter.browserDetails.browser == \"firefox\" || adapter.browserDetails.browser == \"edge\") {\r\n      mediaConstraints = {\r\n        offerToReceiveAudio: isAudioRecvEnabled(media),\r\n        offerToReceiveVideo: isVideoRecvEnabled(media),\r\n      };\r\n    } else {\r\n      mediaConstraints = {\r\n        mandatory: {\r\n          OfferToReceiveAudio: isAudioRecvEnabled(media),\r\n          OfferToReceiveVideo: isVideoRecvEnabled(media),\r\n        },\r\n      };\r\n    }\r\n    Janus.debug(mediaConstraints);\r\n    config.pc.createAnswer(\r\n      function (answer) {\r\n        Janus.debug(answer);\r\n        if (config.mySdp === null || config.mySdp === undefined) {\r\n          Janus.log(\"Setting local description\");\r\n          config.mySdp = answer.sdp;\r\n          config.pc.setLocalDescription(answer);\r\n        }\r\n        if (!config.iceDone && !config.trickle) {\r\n          // Don't do anything until we have all candidates\r\n          Janus.log(\"Waiting for all candidates...\");\r\n          return;\r\n        }\r\n        if (config.sdpSent) {\r\n          // FIXME badly\r\n          Janus.log(\"Answer already sent, not sending it again\");\r\n          return;\r\n        }\r\n        config.sdpSent = true;\r\n        // JSON.stringify doesn't work on some WebRTC objects anymore\r\n        // See https://code.google.com/p/chromium/issues/detail?id=467366\r\n        var jsep = {\r\n          type: answer.type,\r\n          sdp: answer.sdp,\r\n        };\r\n        callbacks.success(jsep);\r\n      },\r\n      callbacks.error,\r\n      mediaConstraints\r\n    );\r\n  }\r\n\r\n  function sendSDP(handleId, callbacks) {\r\n    callbacks = callbacks || {};\r\n    callbacks.success = typeof callbacks.success == \"function\" ? callbacks.success : Janus.noop;\r\n    callbacks.error = typeof callbacks.error == \"function\" ? callbacks.error : Janus.noop;\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (\r\n      pluginHandle === null ||\r\n      pluginHandle === undefined ||\r\n      pluginHandle.webrtcStuff === null ||\r\n      pluginHandle.webrtcStuff === undefined\r\n    ) {\r\n      Janus.warn(\"Invalid handle, not sending anything\");\r\n      return;\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    Janus.log(\"Sending offer/answer SDP...\");\r\n    if (config.mySdp === null || config.mySdp === undefined) {\r\n      Janus.warn(\"Local SDP instance is invalid, not sending anything...\");\r\n      return;\r\n    }\r\n    config.mySdp = {\r\n      type: config.pc.localDescription.type,\r\n      sdp: config.pc.localDescription.sdp,\r\n    };\r\n    if (config.sdpSent) {\r\n      Janus.log(\"Offer/Answer SDP already sent, not sending it again\");\r\n      return;\r\n    }\r\n    if (config.trickle === false) config.mySdp[\"trickle\"] = false;\r\n    Janus.debug(callbacks);\r\n    config.sdpSent = true;\r\n    callbacks.success(config.mySdp);\r\n  }\r\n\r\n  function getVolume(handleId) {\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (\r\n      pluginHandle === null ||\r\n      pluginHandle === undefined ||\r\n      pluginHandle.webrtcStuff === null ||\r\n      pluginHandle.webrtcStuff === undefined\r\n    ) {\r\n      Janus.warn(\"Invalid handle\");\r\n      return 0;\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    // Start getting the volume, if getStats is supported\r\n    if (config.pc.getStats && adapter.browserDetails.browser == \"chrome\") {\r\n      // FIXME\r\n      if (config.remoteStream === null || config.remoteStream === undefined) {\r\n        Janus.warn(\"Remote stream unavailable\");\r\n        return 0;\r\n      }\r\n      // http://webrtc.googlecode.com/svn/trunk/samples/js/demos/html/constraints-and-stats.html\r\n      if (config.volume.timer === null || config.volume.timer === undefined) {\r\n        Janus.log(\"Starting volume monitor\");\r\n        config.volume.timer = setInterval(function () {\r\n          config.pc.getStats(function (stats) {\r\n            var results = stats.result();\r\n            for (var i = 0; i < results.length; i++) {\r\n              var res = results[i];\r\n              if (res.type == \"ssrc\" && res.stat(\"audioOutputLevel\")) {\r\n                config.volume.value = res.stat(\"audioOutputLevel\");\r\n              }\r\n            }\r\n          });\r\n        }, 200);\r\n        return 0; // We don't have a volume to return yet\r\n      }\r\n      return config.volume.value;\r\n    } else {\r\n      Janus.log(\"Getting the remote volume unsupported by browser\");\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  function isMuted(handleId, video) {\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (\r\n      pluginHandle === null ||\r\n      pluginHandle === undefined ||\r\n      pluginHandle.webrtcStuff === null ||\r\n      pluginHandle.webrtcStuff === undefined\r\n    ) {\r\n      Janus.warn(\"Invalid handle\");\r\n      return true;\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    if (config.pc === null || config.pc === undefined) {\r\n      Janus.warn(\"Invalid PeerConnection\");\r\n      return true;\r\n    }\r\n    if (config.myStream === undefined || config.myStream === null) {\r\n      Janus.warn(\"Invalid local MediaStream\");\r\n      return true;\r\n    }\r\n    if (video) {\r\n      // Check video track\r\n      if (\r\n        config.myStream.getVideoTracks() === null ||\r\n        config.myStream.getVideoTracks() === undefined ||\r\n        config.myStream.getVideoTracks().length === 0\r\n      ) {\r\n        Janus.warn(\"No video track\");\r\n        return true;\r\n      }\r\n      return !config.myStream.getVideoTracks()[0].enabled;\r\n    } else {\r\n      // Check audio track\r\n      if (\r\n        config.myStream.getAudioTracks() === null ||\r\n        config.myStream.getAudioTracks() === undefined ||\r\n        config.myStream.getAudioTracks().length === 0\r\n      ) {\r\n        Janus.warn(\"No audio track\");\r\n        return true;\r\n      }\r\n      return !config.myStream.getAudioTracks()[0].enabled;\r\n    }\r\n  }\r\n\r\n  function mute(handleId, video, mute) {\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (\r\n      pluginHandle === null ||\r\n      pluginHandle === undefined ||\r\n      pluginHandle.webrtcStuff === null ||\r\n      pluginHandle.webrtcStuff === undefined\r\n    ) {\r\n      Janus.warn(\"Invalid handle\");\r\n      return false;\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    if (config.pc === null || config.pc === undefined) {\r\n      Janus.warn(\"Invalid PeerConnection\");\r\n      return false;\r\n    }\r\n    if (config.myStream === undefined || config.myStream === null) {\r\n      Janus.warn(\"Invalid local MediaStream\");\r\n      return false;\r\n    }\r\n    if (video) {\r\n      // Mute/unmute video track\r\n      if (\r\n        config.myStream.getVideoTracks() === null ||\r\n        config.myStream.getVideoTracks() === undefined ||\r\n        config.myStream.getVideoTracks().length === 0\r\n      ) {\r\n        Janus.warn(\"No video track\");\r\n        return false;\r\n      }\r\n      config.myStream.getVideoTracks()[0].enabled = mute ? false : true;\r\n      return true;\r\n    } else {\r\n      // Mute/unmute audio track\r\n      if (\r\n        config.myStream.getAudioTracks() === null ||\r\n        config.myStream.getAudioTracks() === undefined ||\r\n        config.myStream.getAudioTracks().length === 0\r\n      ) {\r\n        Janus.warn(\"No audio track\");\r\n        return false;\r\n      }\r\n      config.myStream.getAudioTracks()[0].enabled = mute ? false : true;\r\n      return true;\r\n    }\r\n  }\r\n\r\n  function getBitrate(handleId) {\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (\r\n      pluginHandle === null ||\r\n      pluginHandle === undefined ||\r\n      pluginHandle.webrtcStuff === null ||\r\n      pluginHandle.webrtcStuff === undefined\r\n    ) {\r\n      Janus.warn(\"Invalid handle\");\r\n      return \"Invalid handle\";\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    if (config.pc === null || config.pc === undefined) return \"Invalid PeerConnection\";\r\n    // Start getting the bitrate, if getStats is supported\r\n    if (config.pc.getStats && adapter.browserDetails.browser == \"chrome\") {\r\n      // Do it the Chrome way\r\n      if (config.remoteStream === null || config.remoteStream === undefined) {\r\n        Janus.warn(\"Remote stream unavailable\");\r\n        return \"Remote stream unavailable\";\r\n      }\r\n      // http://webrtc.googlecode.com/svn/trunk/samples/js/demos/html/constraints-and-stats.html\r\n      if (config.bitrate.timer === null || config.bitrate.timer === undefined) {\r\n        Janus.log(\"Starting bitrate timer (Chrome)\");\r\n        config.bitrate.timer = setInterval(function () {\r\n          config.pc.getStats(function (stats) {\r\n            var results = stats.result();\r\n            for (var i = 0; i < results.length; i++) {\r\n              var res = results[i];\r\n              if (res.type == \"ssrc\" && res.stat(\"googFrameHeightReceived\")) {\r\n                config.bitrate.bsnow = res.stat(\"bytesReceived\");\r\n                config.bitrate.tsnow = res.timestamp;\r\n                if (config.bitrate.bsbefore === null || config.bitrate.tsbefore === null) {\r\n                  // Skip this round\r\n                  config.bitrate.bsbefore = config.bitrate.bsnow;\r\n                  config.bitrate.tsbefore = config.bitrate.tsnow;\r\n                } else {\r\n                  // Calculate bitrate\r\n                  var bitRate = Math.round(\r\n                    ((config.bitrate.bsnow - config.bitrate.bsbefore) * 8) /\r\n                      (config.bitrate.tsnow - config.bitrate.tsbefore)\r\n                  );\r\n                  config.bitrate.value = bitRate + \" kbits/sec\";\r\n                  //~ Janus.log(\"Estimated bitrate is \" + config.bitrate.value);\r\n                  config.bitrate.bsbefore = config.bitrate.bsnow;\r\n                  config.bitrate.tsbefore = config.bitrate.tsnow;\r\n                }\r\n              }\r\n            }\r\n          });\r\n        }, 1000);\r\n        return \"0 kbits/sec\"; // We don't have a bitrate value yet\r\n      }\r\n      return config.bitrate.value;\r\n    } else if (config.pc.getStats && adapter.browserDetails.browser == \"firefox\") {\r\n      // Do it the Firefox way\r\n      if (\r\n        config.remoteStream === null ||\r\n        config.remoteStream === undefined ||\r\n        config.remoteStream.streams[0] === null ||\r\n        config.remoteStream.streams[0] === undefined\r\n      ) {\r\n        Janus.warn(\"Remote stream unavailable\");\r\n        return \"Remote stream unavailable\";\r\n      }\r\n      var videoTracks = config.remoteStream.streams[0].getVideoTracks();\r\n      if (videoTracks === null || videoTracks === undefined || videoTracks.length < 1) {\r\n        Janus.warn(\"No video track\");\r\n        return \"No video track\";\r\n      }\r\n      // https://github.com/muaz-khan/getStats/blob/master/getStats.js\r\n      if (config.bitrate.timer === null || config.bitrate.timer === undefined) {\r\n        Janus.log(\"Starting bitrate timer (Firefox)\");\r\n        config.bitrate.timer = setInterval(function () {\r\n          // We need a helper callback\r\n          var cb = function (res) {\r\n            if (\r\n              res === null ||\r\n              res === undefined ||\r\n              res.inbound_rtp_video_1 == null ||\r\n              res.inbound_rtp_video_1 == null\r\n            ) {\r\n              config.bitrate.value = \"Missing inbound_rtp_video_1\";\r\n              return;\r\n            }\r\n            config.bitrate.bsnow = res.inbound_rtp_video_1.bytesReceived;\r\n            config.bitrate.tsnow = res.inbound_rtp_video_1.timestamp;\r\n            if (config.bitrate.bsbefore === null || config.bitrate.tsbefore === null) {\r\n              // Skip this round\r\n              config.bitrate.bsbefore = config.bitrate.bsnow;\r\n              config.bitrate.tsbefore = config.bitrate.tsnow;\r\n            } else {\r\n              // Calculate bitrate\r\n              var bitRate = Math.round(\r\n                ((config.bitrate.bsnow - config.bitrate.bsbefore) * 8) /\r\n                  (config.bitrate.tsnow - config.bitrate.tsbefore)\r\n              );\r\n              config.bitrate.value = bitRate + \" kbits/sec\";\r\n              config.bitrate.bsbefore = config.bitrate.bsnow;\r\n              config.bitrate.tsbefore = config.bitrate.tsnow;\r\n            }\r\n          };\r\n          // Actually get the stats\r\n          config.pc.getStats(\r\n            videoTracks[0],\r\n            function (stats) {\r\n              cb(stats);\r\n            },\r\n            cb\r\n          );\r\n        }, 1000);\r\n        return \"0 kbits/sec\"; // We don't have a bitrate value yet\r\n      }\r\n      return config.bitrate.value;\r\n    } else {\r\n      Janus.warn(\"Getting the video bitrate unsupported by browser\");\r\n      return \"Feature unsupported by browser\";\r\n    }\r\n  }\r\n\r\n  function webrtcError(error) {\r\n    Janus.error(\"WebRTC error:\", error);\r\n  }\r\n\r\n  function cleanupWebrtc(handleId, hangupRequest) {\r\n    Janus.log(\"Cleaning WebRTC stuff\");\r\n    var pluginHandle = pluginHandles[handleId];\r\n    if (pluginHandle === null || pluginHandle === undefined) {\r\n      // Nothing to clean\r\n      return;\r\n    }\r\n    var config = pluginHandle.webrtcStuff;\r\n    if (config !== null && config !== undefined) {\r\n      if (hangupRequest === true) {\r\n        // Send a hangup request (we don't really care about the response)\r\n        var request = { janus: \"hangup\", transaction: Janus.randomString(12) };\r\n        if (token !== null && token !== undefined) request[\"token\"] = token;\r\n        if (apisecret !== null && apisecret !== undefined) request[\"apisecret\"] = apisecret;\r\n        Janus.debug(\"Sending hangup request (handle=\" + handleId + \"):\");\r\n        Janus.debug(request);\r\n        if (websockets) {\r\n          request[\"session_id\"] = sessionId;\r\n          request[\"handle_id\"] = handleId;\r\n          ws.send(JSON.stringify(request));\r\n        } else {\r\n          Janus.ajax({\r\n            type: \"POST\",\r\n            url: server + \"/\" + sessionId + \"/\" + handleId,\r\n            withCredentials: withCredentials,\r\n            cache: false,\r\n            contentType: \"application/json\",\r\n            data: JSON.stringify(request),\r\n            dataType: \"json\",\r\n          });\r\n        }\r\n      }\r\n      // Cleanup stack\r\n      config.remoteStream = null;\r\n      if (config.volume.timer) clearInterval(config.volume.timer);\r\n      config.volume.value = null;\r\n      if (config.bitrate.timer) clearInterval(config.bitrate.timer);\r\n      config.bitrate.timer = null;\r\n      config.bitrate.bsnow = null;\r\n      config.bitrate.bsbefore = null;\r\n      config.bitrate.tsnow = null;\r\n      config.bitrate.tsbefore = null;\r\n      config.bitrate.value = null;\r\n      try {\r\n        // Try a MediaStream.stop() first\r\n        if (!config.streamExternal && config.myStream !== null && config.myStream !== undefined) {\r\n          Janus.log(\"Stopping local stream\");\r\n          config.myStream.stop();\r\n        }\r\n      } catch (e) {\r\n        // Do nothing if this fails\r\n      }\r\n      try {\r\n        // Try a MediaStreamTrack.stop() for each track as well\r\n        if (!config.streamExternal && config.myStream !== null && config.myStream !== undefined) {\r\n          Janus.log(\"Stopping local stream tracks\");\r\n          var tracks = config.myStream.getTracks();\r\n          for (var i in tracks) {\r\n            var mst = tracks[i];\r\n            Janus.log(mst);\r\n            if (mst !== null && mst !== undefined) mst.stop();\r\n          }\r\n        }\r\n      } catch (e) {\r\n        // Do nothing if this fails\r\n      }\r\n      config.streamExternal = false;\r\n      config.myStream = null;\r\n      // Close PeerConnection\r\n      try {\r\n        config.pc.close();\r\n      } catch (e) {\r\n        // Do nothing\r\n      }\r\n      config.pc = null;\r\n      config.mySdp = null;\r\n      config.iceDone = false;\r\n      config.sdpSent = false;\r\n      config.dataChannel = null;\r\n      config.dtmfSender = null;\r\n    }\r\n    pluginHandle.oncleanup();\r\n  }\r\n\r\n  // Helper methods to parse a media object\r\n  function isAudioSendEnabled(media) {\r\n    Janus.debug(\"isAudioSendEnabled:\", media);\r\n    if (media === undefined || media === null) return true; // Default\r\n    if (media.audio === false) return false; // Generic audio has precedence\r\n    if (media.audioSend === undefined || media.audioSend === null) return true; // Default\r\n    return media.audioSend === true;\r\n  }\r\n\r\n  function isAudioSendRequired(media) {\r\n    Janus.debug(\"isAudioSendRequired:\", media);\r\n    if (media === undefined || media === null) return false; // Default\r\n    if (media.audio === false || media.audioSend === false) return false; // If we're not asking to capture audio, it's not required\r\n    if (media.failIfNoAudio === undefined || media.failIfNoAudio === null) return false; // Default\r\n    return media.failIfNoAudio === true;\r\n  }\r\n\r\n  function isAudioRecvEnabled(media) {\r\n    Janus.debug(\"isAudioRecvEnabled:\", media);\r\n    if (media === undefined || media === null) return true; // Default\r\n    if (media.audio === false) return false; // Generic audio has precedence\r\n    if (media.audioRecv === undefined || media.audioRecv === null) return true; // Default\r\n    return media.audioRecv === true;\r\n  }\r\n\r\n  function isVideoSendEnabled(media) {\r\n    Janus.debug(\"isVideoSendEnabled:\", media);\r\n    if (media === undefined || media === null) return true; // Default\r\n    if (media.video === false) return false; // Generic video has precedence\r\n    if (media.videoSend === undefined || media.videoSend === null) return true; // Default\r\n    return media.videoSend === true;\r\n  }\r\n\r\n  function isVideoSendRequired(media) {\r\n    Janus.debug(\"isVideoSendRequired:\", media);\r\n    if (media === undefined || media === null) return false; // Default\r\n    if (media.video === false || media.videoSend === false) return false; // If we're not asking to capture video, it's not required\r\n    if (media.failIfNoVideo === undefined || media.failIfNoVideo === null) return false; // Default\r\n    return media.failIfNoVideo === true;\r\n  }\r\n\r\n  function isVideoRecvEnabled(media) {\r\n    Janus.debug(\"isVideoRecvEnabled:\", media);\r\n    if (media === undefined || media === null) return true; // Default\r\n    if (media.video === false) return false; // Generic video has precedence\r\n    if (media.videoRecv === undefined || media.videoRecv === null) return true; // Default\r\n    return media.videoRecv === true;\r\n  }\r\n\r\n  function isDataEnabled(media) {\r\n    Janus.debug(\"isDataEnabled:\", media);\r\n    if (adapter.browserDetails.browser == \"edge\") {\r\n      Janus.warn(\"Edge doesn't support data channels yet\");\r\n      return false;\r\n    }\r\n    if (media === undefined || media === null) return false; // Default\r\n    return media.data === true;\r\n  }\r\n\r\n  function isTrickleEnabled(trickle) {\r\n    Janus.debug(\"isTrickleEnabled:\", trickle);\r\n    if (trickle === undefined || trickle === null) return true; // Default is true\r\n    return trickle === true;\r\n  }\r\n}\r\n\r\nexport default Janus;\r\n","import dayjs from \"dayjs\";\r\nimport { FROM_NAME, FROM_USER_ID } from \"../../web.config\";\r\nimport { newMessageChatWidget } from \"../../reducer/ChatWidget/actions\";\r\nimport Janus from \"./janus\";\r\n\r\nexport function publishChatroom(\r\n  janus,\r\n  opaqueId,\r\n  isPublisher,\r\n  chatroomId,\r\n  username,\r\n  display,\r\n  callback\r\n) {\r\n  let chatroomHandler;\r\n\r\n  if (!janus) {\r\n    return;\r\n  }\r\n\r\n  janus.attach({\r\n    plugin: \"janus.plugin.textroom\",\r\n    opaqueId: opaqueId,\r\n    success: function (pluginHandle) {\r\n      console.log(\"++++++++++++++++++++++++++++++++++++++++++++++\");\r\n      console.log(pluginHandle);\r\n      chatroomHandler = pluginHandle;\r\n\r\n      var body = { request: \"setup\" };\r\n      console.log(\"###############\" +JSON.stringify(body));\r\n      chatroomHandler.send({ message: body });\r\n    },\r\n    error: function (error) {\r\n      console.error(\"  -- Error attaching plugin...\", error);\r\n    },\r\n    webrtcState: function (on) {\r\n      Janus.log(\"Janus says our WebRTC PeerConnection is \" + (on ? \"up\" : \"down\") + \" now\");\r\n    },\r\n    onmessage: function (msg, jsep) {\r\n      Janus.debug(\" ::: Got a message :::\");\r\n      Janus.debug(msg);\r\n      if (msg[\"error\"] !== undefined && msg[\"error\"] !== null) {\r\n        //todo error\r\n      }\r\n      if (jsep !== undefined && jsep !== null) {\r\n        // Answer\r\n        chatroomHandler.createAnswer({\r\n          jsep: jsep,\r\n          media: { audio: false, video: false, data: true }, // We only use datachannels\r\n          success: function (jsep) {\r\n            Janus.debug(\"Got SDP!\");\r\n            Janus.debug(jsep);\r\n            var request = { request: \"ack\" };\r\n            chatroomHandler.send({ message: request, jsep: jsep });\r\n          },\r\n          error: function (error) {\r\n            Janus.error(\"WebRTC error:\", error);\r\n          },\r\n        });\r\n      }\r\n    },\r\n    ondataopen: function (data) {\r\n      Janus.log(\"The DataChannel is available!\");\r\n      if (isPublisher) {\r\n        const request = {\r\n          request: \"create\",\r\n        };\r\n        chatroomHandler.send({\r\n          message: request,\r\n          success: (data) => {\r\n            console.log(\"==== ondataopen ====\");\r\n            console.log(data);\r\n            const roomId = data.room;\r\n            // const roomId = chatroomId;\r\n\r\n            callback(chatroomHandler, \"created\", roomId);\r\n\r\n            const request = {\r\n              textroom: \"join\",\r\n              transaction: randomString(12),\r\n              room: roomId,\r\n              username: username,\r\n              display: display,\r\n            };\r\n            chatroomHandler.data({\r\n              text: JSON.stringify(request),\r\n              success: (data) => {\r\n                console.log(\"Publisher joined\");\r\n                callback(chatroomHandler, \"joined\");\r\n              },\r\n            });\r\n          },\r\n        });\r\n      } else {\r\n        const request = {\r\n          textroom: \"join\",\r\n          transaction: randomString(12),\r\n          room: chatroomId,\r\n          username: username,\r\n          display: display,\r\n        };\r\n        chatroomHandler.data({\r\n          text: JSON.stringify(request),\r\n          success: (data) => {\r\n            console.log(\"Subscriber joined\");\r\n            callback(chatroomHandler, \"joined\");\r\n          },\r\n        });\r\n      }\r\n    },\r\n    ondata: function (data) {\r\n      Janus.debug(\"We got data from the DataChannel! \");\r\n      console.log(\"==================\");\r\n      console.log(data);\r\n\r\n      const json = JSON.parse(data);\r\n      const event = json[\"textroom\"];\r\n\r\n      if (event === \"message\") {\r\n        const msg = {\r\n          room: json[\"room\"],\r\n          from: json[\"from\"],\r\n          data: JSON.parse(json[\"text\"]).text,\r\n          date: dayjs(json[\"date\"]).valueOf(),\r\n        };\r\n        callback(chatroomHandler, \"ondata\", msg);\r\n      } else if (event === \"announcement\") {\r\n      } else if (event === \"join\") {\r\n      } else if (event === \"leave\") {\r\n      } else if (event === \"kicked\") {\r\n      } else if (event === \"destroyed\") {\r\n      }\r\n    },\r\n    oncleanup: function () {\r\n      Janus.log(\" ::: Got a cleanup notification :::\");\r\n    },\r\n  });\r\n}\r\n\r\nfunction randomString(len, charSet) {\r\n  charSet = charSet || \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n  var randomString = \"\";\r\n  for (var i = 0; i < len; i++) {\r\n    var randomPoz = Math.floor(Math.random() * charSet.length);\r\n    randomString += charSet.substring(randomPoz, randomPoz + 1);\r\n  }\r\n  return randomString;\r\n}\r\n\r\nexport function sendData(chatroomHandler, chatroom, data, callbackDispatch) {\r\n  var message = {\r\n    textroom: \"message\",\r\n    transaction: randomString(12),\r\n    room: chatroom,\r\n    text: data,\r\n    ack: false,\r\n  };\r\n\r\n  chatroomHandler.data({\r\n    text: JSON.stringify(message),\r\n    error: function (reason) {},\r\n    success: function () {\r\n      const eventJanus = JSON.parse(message.text);\r\n      console.log(\"==== sendData ====\");\r\n      console.log(message);\r\n\r\n      if (eventJanus.event == \"sent\") {\r\n        console.log(\"*** sendData\");\r\n        console.log(message);\r\n        const dataBody = {\r\n          room_id: message.room,\r\n          partner_user_id: FROM_USER_ID,\r\n          from: FROM_NAME,\r\n          time: JSON.stringify(dayjs().valueOf()),\r\n          text: message.text,\r\n        };\r\n        callbackDispatch(newMessageChatWidget(dataBody));\r\n      } else if (eventJanus.event == \"typing\") {\r\n      }\r\n    },\r\n  });\r\n}\r\n","import { CHAT_SCROLLLOAD, CHAT_NEW_MESSAGE, REQUIRE_ROOM } from \"./types\";\r\nimport { chatScrollLoad, newMessage } from \"../../apis/chat\";\r\nimport { requireRoom } from \"../../apis/room\";\r\nimport dayjs from \"dayjs\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\n\r\nexport const requireRoomAction = (dataBody) => async (dispatch, getState) => {\r\n  dispatch({ type: REQUIRE_ROOM.REQUEST });\r\n\r\n  console.log(\"***** action: requireRoomAction ****\");\r\n  try {\r\n    console.log(\"==== dataBody ====\");\r\n    console.log(dataBody);\r\n    const responseRoom = await requireRoom(dataBody);\r\n    console.log(responseRoom);\r\n\r\n    if (responseRoom.status) {\r\n      dispatch({ type: REQUIRE_ROOM.SUCCESS, payload: { room: responseRoom.data.data.room } });\r\n    } else {\r\n      dispatch({\r\n        type: REQUIRE_ROOM.ERROR,\r\n        error: \"error\",\r\n      });\r\n    }\r\n  } catch (error) {\r\n    dispatch({\r\n      type: REQUIRE_ROOM.ERROR,\r\n      error,\r\n    });\r\n  }\r\n};\r\n\r\nexport const newMessageChatWidget = (data) => async (dispatch, getState) => {\r\n  dispatch({ type: CHAT_NEW_MESSAGE.REQUEST });\r\n\r\n  console.log(\"***** action: newMessageChatWidget ****\");\r\n  try {\r\n    console.log(\"====== action: newMessage RAW =====\");\r\n    console.log(data);\r\n\r\n    const responseMessage = await newMessage(data);\r\n\r\n    if (responseMessage.status) {\r\n      console.log(\"====* newMessageChatWidget *====\");\r\n      console.log(responseMessage);\r\n\r\n      dispatch({\r\n        type: CHAT_NEW_MESSAGE.SUCCESS,\r\n        payload: {\r\n          message: responseMessage.data.data,\r\n        },\r\n      });\r\n    } else {\r\n      dispatch({\r\n        type: CHAT_NEW_MESSAGE.ERROR,\r\n        error: \"error\",\r\n      });\r\n    }\r\n  } catch (error) {\r\n    dispatch({\r\n      type: CHAT_NEW_MESSAGE.ERROR,\r\n      error,\r\n    });\r\n  }\r\n};\r\n\r\nexport const chatScrollLoadAction = () => async (dispatch, getState) => {\r\n  console.log(\"===**** getState\");\r\n  const state = getState();\r\n\r\n  dispatch({ type: CHAT_SCROLLLOAD.REQUEST });\r\n\r\n  try {\r\n    const params = {\r\n      room: state.chat.room,\r\n    };\r\n    console.log(\"params\")\r\n    console.log(params)\r\n    const responseChat = await chatScrollLoad(params);\r\n\r\n    if (responseChat.status) {\r\n      const {\r\n        data: { count, list },\r\n        status: scrollLoadStatus,\r\n      } = responseChat.data;\r\n      console.log(\"0000* chatScrollLoadAction\")\r\n      console.log(responseChat.data)\r\n\r\n      dispatch({\r\n        type: CHAT_SCROLLLOAD.SUCCESS,\r\n        payload: {\r\n          listCount: count,\r\n          list,\r\n          scrollLoadStatus,\r\n        },\r\n      });\r\n    } else {\r\n      // dispatch({ type: CHAT_SCROLLLOAD.ERROR, payload: { error } });\r\n    }\r\n  } catch (error) {\r\n    dispatch({ type: CHAT_SCROLLLOAD.ERROR, payload: { error } });\r\n  }\r\n};\r\n","import { faTimes } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport React from \"react\";\r\n\r\nfunction AddMsgReply({ handleCancelAddMsgReply, messReplyContent }) {\r\n  return (\r\n    <div className=\"add-msg__reply\">\r\n      <div className=\"add-msg__container\">\r\n        <div className=\"add-msg__reply__title\">\r\n          ang tr li <strong> Nhn vin CSKH </strong>\r\n        </div>\r\n        <p className=\"add-msg__reply__content\"> {messReplyContent} </p>\r\n      </div>\r\n      <div className=\"add-msg__cancel\" onClick={handleCancelAddMsgReply}>\r\n        <FontAwesomeIcon icon={faTimes} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nAddMsgReply.propTypes = {};\r\n\r\nexport default AddMsgReply;\r\n","import { faCamera, faPaperPlane } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport dayjs from \"dayjs\";\r\nimport React, { useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport { sendData } from \"../../../utils/Janus/chatroom\";\r\nimport AddMsgReply from \"./AddMsgReply\";\r\n\r\nfunction randomString(len, charSet) {\r\n  charSet = charSet || \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n  var randomString = \"\";\r\n  for (var i = 0; i < len; i++) {\r\n    var randomPoz = Math.floor(Math.random() * charSet.length);\r\n    randomString += charSet.substring(randomPoz, randomPoz + 1);\r\n  }\r\n  return randomString;\r\n}\r\nfunction AddMsgBox({\r\n  addMsgReplyVisible,\r\n  handleCancelAddMsgReply,\r\n  messReplyContent,\r\n  chatroomHandler,\r\n}) {\r\n  const dispatch = useDispatch();\r\n\r\n  const [currentMessage, setCurrentMessage] = useState(\"\");\r\n\r\n  const { isConnected } = useSelector((state) => state.janus);\r\n  const { room: chatroom, listCount, list } = useSelector((state) => state.chat);\r\n\r\n  const onMessageSend = () => {\r\n    if (currentMessage && isConnected) {\r\n      const dataJanus = JSON.stringify({\r\n        id: uuidv4(),\r\n        text: currentMessage,\r\n        room: chatroom,\r\n        time: dayjs().valueOf(),\r\n        event: \"sent\",\r\n      });\r\n\r\n      sendData(chatroomHandler, chatroom, dataJanus, dispatch);\r\n\r\n      setCurrentMessage(\"\");\r\n    }\r\n  };\r\n\r\n  const onKeyUp = (e) => {\r\n    if (e.keyCode === 13) {\r\n      e.preventDefault();\r\n      document.querySelector(\".add-msg__send\").click();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"add-msg\">\r\n      {addMsgReplyVisible ? (\r\n        <AddMsgReply\r\n          handleCancelAddMsgReply={handleCancelAddMsgReply}\r\n          messReplyContent={messReplyContent}\r\n        />\r\n      ) : (\r\n        \"\"\r\n      )}\r\n      <div className=\"add-msg__wrap\">\r\n        <div className=\"add-msg__camera\">\r\n          <input type=\"file\" title=\"\" accept=\"image/*\" />\r\n          <FontAwesomeIcon icon={faCamera} />\r\n        </div>\r\n        <input\r\n          className=\"add-msg__message\"\r\n          type=\"text\"\r\n          value={currentMessage}\r\n          onChange={(e) => setCurrentMessage(e.target.value)}\r\n          onKeyUp={onKeyUp}\r\n        />\r\n        <div className=\"add-msg__send\" onClick={onMessageSend}>\r\n          <FontAwesomeIcon icon={faPaperPlane} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nAddMsgBox.propTypes = {};\r\n\r\nexport default AddMsgBox;\r\n","import { faTimes } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport React from \"react\";\r\n\r\nfunction ChatTabSearchBar(props) {\r\n  return (\r\n    <div className=\"chat-tab__title__search-bar\">\r\n      <div className=\"chat-tab__title__search-bar__wrap-input\">\r\n        <input type=\"search\" placeholder=\"Search\" />\r\n        {/* <button type=\"button\" className=\"chat-tab__title__search-bar__times-btn\">\r\n          <FontAwesomeIcon icon={faTimes} />\r\n        </button> */}\r\n      </div>\r\n      <p className=\"chat-tab__title__search-bar__result\"> 1 / 2 kt qu cho \"khach hang\" </p>\r\n    </div>\r\n  );\r\n}\r\n\r\nChatTabSearchBar.propTypes = {};\r\n\r\nexport default ChatTabSearchBar;\r\n","import { faMinus, faPhoneAlt, faSearch } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport React from \"react\";\r\nimport ChatTabSearchBar from \"./ChatTabSearchBar\";\r\n\r\nfunction ChatTabGroupTitle({\r\n  handleClickPhoneBtn,\r\n  handleClickSeachBtn,\r\n  handleClickMinimizedIcon,\r\n  searchBarVisible,\r\n}) {\r\n  return (\r\n    <div className=\"chat-tab__title\">\r\n      <div className=\"chat-tab__title__group\">\r\n        <h2> Chat vi nhn vin CSKH </h2>\r\n        <ul className=\"chat-tab__actions\">\r\n          <li className=\"items\" id=\"phoneBtn\" onClick={handleClickPhoneBtn}>\r\n            <FontAwesomeIcon icon={faPhoneAlt} />\r\n          </li>\r\n          <li className=\"items\" onClick={handleClickSeachBtn}>\r\n            <FontAwesomeIcon icon={faSearch} />\r\n          </li>\r\n          <li className=\"items\" onClick={handleClickMinimizedIcon}>\r\n            <FontAwesomeIcon icon={faMinus} />\r\n          </li>\r\n        </ul>\r\n      </div>\r\n      {searchBarVisible ? <ChatTabSearchBar /> : \"\"}\r\n    </div>\r\n  );\r\n}\r\n\r\nChatTabGroupTitle.propTypes = {};\r\n\r\nexport default ChatTabGroupTitle;\r\n","import { faReply, faUserCircle } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport React from \"react\";\r\nimport dayjs from \"dayjs\";\r\nimport parser from \"bbcode-to-react\";\r\nfunction PostReply({ handleClickReplyBtn, messContent, time, username }) {\r\n  return (\r\n    <li className=\"reply-post\">\r\n      <div className=\"reply-post__time\"> {dayjs(time).format(\"HH:ss DD-MM-YYYY\")} </div>\r\n      <div className=\"reply-group\">\r\n        <div className=\"reply-group__actions\">\r\n          <div\r\n            className=\"post__controls__icon-btn\"\r\n            onClick={() => handleClickReplyBtn(messContent)}\r\n          >\r\n            <FontAwesomeIcon icon={faReply} />\r\n          </div>\r\n        </div>\r\n        <div className=\"reply-group__content\">\r\n          {messContent.indexOf(\"[img]\") !== -1 && messContent.indexOf(\"[/img]\") !== -1 ? (\r\n            <>{parser.toReact(messContent)}</>\r\n          ) : (\r\n            <p>{messContent}</p>\r\n          )}\r\n        </div>\r\n        <div className=\"reply-group__avatar\">\r\n          <div className=\"reply-group__avatar__icon\">\r\n            <img src={`https://avatars.dicebear.com/api/human/${username}.svg`} alt=\"\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </li>\r\n  );\r\n}\r\n\r\nPostReply.propTypes = {};\r\n\r\nexport default PostReply;\r\n","export default __webpack_public_path__ + \"static/media/hasaki-logo.9b7d9453.png\";","import { faReply, faUserCircle } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport React from \"react\";\r\nimport hasakiLogo from \"../../../images/hasaki-logo.png\";\r\nimport dayjs from \"dayjs\";\r\nimport parser from \"bbcode-to-react\";\r\nimport { renderToString } from \"react-dom/server\";\r\n\r\nfunction PostSent({ handleClickReplyBtn, messContent, time, username }) {\r\n  return (\r\n    <li className=\"sent-post\">\r\n      <div className=\"sent-post__time\"> {dayjs(time).format(\"HH:ss DD-MM-YYYY\")} </div>\r\n      <div className=\"sent-group\">\r\n        <div className=\"sent-group__avatar\">\r\n          <div className=\"sent-group__avatar__icon\">\r\n            <img src={`https://avatars.dicebear.com/api/human/${username}.svg`} alt=\"\" />\r\n          </div>\r\n        </div>\r\n        <div className=\"sent-group__content\">\r\n          {messContent.indexOf(\"[img]\") !== -1 && messContent.indexOf(\"[/img]\") !== -1 ? (\r\n            <>{parser.toReact(messContent)}</>\r\n          ) : (\r\n            <p>{messContent}</p>\r\n          )}\r\n        </div>\r\n        <div className=\"sent-group__actions\">\r\n          <div\r\n            className=\"post__controls__icon-btn\"\r\n            onClick={() => handleClickReplyBtn(messContent)}\r\n          >\r\n            <FontAwesomeIcon icon={faReply} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </li>\r\n  );\r\n}\r\n\r\nPostSent.propTypes = {};\r\n\r\nexport default PostSent;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport PostReply from \"./PostReply\";\r\nimport PostSent from \"./PostSent\";\r\nimport { useElementOnScreen } from \"../../../utils/useElementOnScreen\";\r\nfunction Posts({ handleClickReplyBtn, list }) {\r\n  const { listCount } = useSelector((state) => state.chat);\r\n  const [containerRef, isInter] = useElementOnScreen({\r\n    root: null,\r\n    rootMargin: \"0px\",\r\n    threshold: 1.0,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (isInter) {\r\n      console.log(\"inter true\");\r\n    } else {\r\n      console.log(\"inter false\");\r\n    }\r\n  }, [isInter]);\r\n\r\n  useEffect(() => {\r\n    var scrollChatPost = document.querySelector(\".chat-tab__posts\");\r\n    if (scrollChatPost) scrollChatPost.scrollTop = scrollChatPost.scrollHeight;\r\n  }, [list]);\r\n\r\n  return (\r\n    <div className=\"chat-tab__posts\">\r\n      <ul>\r\n        {listCount > 0 &&\r\n          list.map((message) => {\r\n            if (message.partner_id == message.room_id?.split(\"-\")[0]) {\r\n              return (\r\n                <PostReply\r\n                  key={message.id}\r\n                  time={message.time}\r\n                  messContent={message.text}\r\n                  username={message.partner_id + \"-\" + message.partner_user_id + \"-\" + message.from}\r\n                  handleClickReplyBtn={handleClickReplyBtn}\r\n                />\r\n              );\r\n            } else {\r\n              return (\r\n                <PostSent\r\n                  key={message.id}\r\n                  time={message.time}\r\n                  messContent={message.text}\r\n                  username={message.partner_id + \"-\" + message.partner_user_id + \"-\" + message.from}\r\n                  handleClickReplyBtn={handleClickReplyBtn}\r\n                />\r\n              );\r\n            }\r\n          })}\r\n      </ul>\r\n    </div>\r\n  );\r\n}\r\n\r\nPosts.propTypes = {};\r\n\r\nexport default Posts;\r\n","import React, { useState } from 'react';\r\nimport { useRef, useEffect } from 'react';\r\n\r\nexport const useElementOnScreen = (options) => {\r\n\tconst containerRef = useRef(null);\r\n\tconst [isInter, setIsInter] = useState(false);\r\n\tconst [prevRatio, setPrevRatio] = useState(0.0);\r\n\r\n\tconst handleIntersect = (entries, observer) => {\r\n\t\tentries.forEach((entry) => {\r\n\t\t\tif (entry.intersectionRatio > prevRatio) {\r\n\t\t\t\tconsole.log(\"inter\")\r\n\t\t\t\tsetIsInter(true);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"des\")\r\n\t\t\t\tsetIsInter(false);\r\n\t\t\t}\r\n\r\n\t\t\tsetPrevRatio(entry.intersectionRatio);\r\n\t\t});\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tconst observer = new IntersectionObserver(handleIntersect, options);\r\n\t\tif (containerRef.current) {\r\n\t\t\tobserver.observe(containerRef.current);\r\n\t\t}\r\n\t\treturn () => {\r\n\t\t\tif (containerRef.current) {\r\n\t\t\t\tobserver.unobserve(containerRef.current);\r\n\t\t\t}\r\n\t\t};\r\n\t}, [containerRef, options]);\r\n\r\n\treturn [containerRef, isInter];\r\n};\r\n","import { faMicrophone, faMicrophoneSlash, faPhoneAlt } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport dayjs from \"dayjs\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { TO_CALL_PARTNER_USERNAME } from \"../../../web.config\";\r\n\r\nfunction CallAlert({ handleClickCancelBtn, handleClickAcceptBtn }) {\r\n  const [currentCallTime, setCurrentCallTime] = useState(null);\r\n  const [useMicrophone, setUseMicrophone] = useState(true);\r\n\r\n  const customCss = {\r\n    border: \"1px solid\",\r\n    borderRadius: \"50%\",\r\n    width: \"50px\",\r\n    height: \"50px\",\r\n  };\r\n\r\n  useEffect(() => {\r\n    setCurrentCallTime(null);\r\n  }, []);\r\n\r\n  const handleTimeUpdate = (track) => {\r\n    let currentTime = Math.floor(track.timeStamp);\r\n    let timeFormat = dayjs(currentTime).format(\"mm:ss\");\r\n    setCurrentCallTime(timeFormat);\r\n  };\r\n\r\n  const handleClickMicrophoneBtn = () => {\r\n    setUseMicrophone(!useMicrophone);\r\n  };\r\n\r\n  return (\r\n    <div className=\"call-alert\">\r\n      <div className=\"call-alert__wrap\">\r\n        <div className=\"call-alert__user\">\r\n          <div className=\"call-alert__user__avatar\">\r\n            <img\r\n              src={`https://avatars.dicebear.com/api/human/${TO_CALL_PARTNER_USERNAME}.svg`}\r\n              alt=\"\"\r\n            />\r\n          </div>\r\n          <div className=\"call-alert__user__name\">Nguyn Trung c</div>\r\n        </div>\r\n        <div className=\"call-alert__status\">\r\n          {currentCallTime ? (\r\n            <p className=\"call-alert__time\">{currentCallTime}</p>\r\n          ) : (\r\n            <>ang gi...</>\r\n          )}\r\n          <div>\r\n            <audio id=\"localAudio\" controls autoPlay playsInline muted></audio>\r\n            <audio\r\n              id=\"remoteAudio\"\r\n              controls\r\n              autoPlay\r\n              playsInline\r\n              onTimeUpdate={handleTimeUpdate}\r\n            ></audio>\r\n          </div>\r\n        </div>\r\n        <div className=\"call-alert__controls\">\r\n          {currentCallTime ? (\r\n            <>\r\n              <button\r\n                className=\"call-alert__controls__item\"\r\n                id=\"cancelBtn\"\r\n                onClick={handleClickCancelBtn}\r\n                style={customCss}\r\n              >\r\n                <div className=\"call-alert__controls__item__icon__cancel\">\r\n                  <FontAwesomeIcon icon={faPhoneAlt} />\r\n                </div>\r\n              </button>\r\n              <button\r\n                className=\"call-alert__controls__item\"\r\n                id=\"microphoneBtn\"\r\n                onClick={handleClickMicrophoneBtn}\r\n                style={customCss}\r\n              >\r\n                <div className=\"call-alert__controls__item__icon__microphone\">\r\n                  <FontAwesomeIcon icon={useMicrophone ? faMicrophone : faMicrophoneSlash} />\r\n                </div>\r\n              </button>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <button\r\n                className=\"call-alert__controls__item\"\r\n                id=\"cancelBtn\"\r\n                onClick={handleClickCancelBtn}\r\n              >\r\n                <div className=\"call-alert__controls__item__icon__cancel\">\r\n                  <FontAwesomeIcon icon={faPhoneAlt} />\r\n                </div>\r\n                Cancel\r\n              </button>\r\n              <button\r\n                className=\"call-alert__controls__item\"\r\n                id=\"acceptBtn\"\r\n                onClick={handleClickAcceptBtn}\r\n              >\r\n                <div className=\"call-alert__controls__item__icon__accept\">\r\n                  <FontAwesomeIcon icon={faPhoneAlt} />\r\n                </div>\r\n                Accept\r\n              </button>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nCallAlert.propTypes = {};\r\n\r\nexport default CallAlert;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport AddMsgBox from \"./AddMsgBox\";\r\nimport ChatTabGroupTitle from \"./ChatTabGroupTitle\";\r\nimport ChatTabSearchBar from \"./ChatTabSearchBar\";\r\nimport Posts from \"./Posts\";\r\nimport { useElementOnScreen } from \"../../../utils/useElementOnScreen\";\r\nimport CallAlert from \"./CallAlert\";\r\n\r\nfunction ChatTab({\r\n  handleClickPhoneBtn,\r\n  handleClickSeachBtn,\r\n  handleClickMinimizedIcon,\r\n  searchBarVisible,\r\n  handleClickReplyBtn,\r\n  addMsgReplyVisible,\r\n  handleCancelAddMsgReply,\r\n  messReplyContent,\r\n  position,\r\n  chatroomHandler,\r\n  callModalVisible,\r\n  handleClickCancelBtn,\r\n  handleClickAcceptBtn,\r\n}) {\r\n  const { listCount, list } = useSelector((state) => state.chat);\r\n  // const [containerRef, isInter] = useElementOnScreen({\r\n  //   root: null,\r\n  //   rootMargin: \"0px\",\r\n  //   threshold: 1.0,\r\n  // });\r\n\r\n  // const { list } = useSelector((state) => state.chat);\r\n\r\n  // useEffect(() => {\r\n  //   var scrollChatPost = document.querySelector(\".chat-tab__posts\");\r\n  //   if (scrollChatPost) scrollChatPost.scrollTop = scrollChatPost.scrollHeight;\r\n  // }, [list, messages]);\r\n\r\n  // useEffect(() => {\r\n  //   if (isInter) {\r\n  //     console.log(\"inter true\");\r\n  //   } else {\r\n  //     console.log(\"inter false\");\r\n  //   }\r\n  // }, [isInter]);\r\n\r\n  return (\r\n    <div\r\n      className=\"chat-tab\"\r\n      style={\r\n        position === \"right\" ? { marginRight: \"3.4375rem\", right: 0 } : { marginLeft: \"3.4375rem\" }\r\n      }\r\n    >\r\n      <ChatTabGroupTitle\r\n        handleClickPhoneBtn={handleClickPhoneBtn}\r\n        handleClickSeachBtn={handleClickSeachBtn}\r\n        handleClickMinimizedIcon={handleClickMinimizedIcon}\r\n        searchBarVisible={searchBarVisible}\r\n      />\r\n\r\n      {callModalVisible ? (\r\n        <CallAlert\r\n          handleClickCancelBtn={handleClickCancelBtn}\r\n          handleClickAcceptBtn={handleClickAcceptBtn}\r\n        />\r\n      ) : (\r\n        <Posts handleClickReplyBtn={handleClickReplyBtn} list={list} />\r\n      )}\r\n\r\n      <AddMsgBox\r\n        messReplyContent={messReplyContent}\r\n        addMsgReplyVisible={addMsgReplyVisible}\r\n        handleCancelAddMsgReply={handleCancelAddMsgReply}\r\n        chatroomHandler={chatroomHandler}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nChatTab.propTypes = {};\r\n\r\nexport default ChatTab;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { chatScrollLoadAction, requireRoomAction } from \"../../reducer/ChatWidget/actions\";\r\nimport { CHAT_NEW_MESSAGE } from \"../../reducer/ChatWidget/types\";\r\nimport { JANUS_CONNECT } from \"../../reducer/Janus/types\";\r\nimport { publishChatroom } from \"../../utils/Janus/chatroom\";\r\nimport Janus from \"../../utils/Janus/janus\";\r\nimport { doAccept, doCall, doHangup, publishVideoCall } from \"../../utils/Janus/videocall\";\r\nimport { FROM_NAME, FROM_USER_ID, TO_CALL_PARTNER_USERNAME, TO_PARTNER_ID } from \"../../web.config\";\r\nimport ChatTab from \"./components/ChatTab\";\r\n\r\nfunction ChatWidget({ position, opaqueId, username, server, isPublisher, display }) {\r\n  const dispatch = useDispatch();\r\n\r\n  const [chatTabVisible, setChatTabVisible] = useState(false);\r\n  const [searchBarVisible, setSearchBarVisible] = useState(false);\r\n  const [callModalVisible, setCallModalVisible] = useState(false);\r\n  const [addMsgReplyVisible, setAddMsgReplyVisible] = useState(false);\r\n\r\n  const [janusInstance, setJanusInstance] = useState(null);\r\n\r\n  const [chatroomHandler, setChatroomHandler] = useState(null);\r\n\r\n  const [messReplyContent, setMessReplyContent] = useState(\"\");\r\n  const [videocallHandler, setVideocallHandler] = useState(null);\r\n  const [callStatus, setCallStatus] = useState(null);\r\n  const [jsep, setJsep] = useState(null);\r\n\r\n  const { room: chatroom } = useSelector((state) => state.chat);\r\n\r\n  useEffect(() => {\r\n    const dataBody = {\r\n      from_user_id: FROM_USER_ID,\r\n      from_name: FROM_NAME,\r\n      to_partner_id: TO_PARTNER_ID,\r\n    };\r\n    dispatch(requireRoomAction(dataBody));\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (chatroom) {\r\n      Janus.init({\r\n        debug: \"all\",\r\n        callback: function () {\r\n          if (!Janus.isWebrtcSupported()) {\r\n            console.log(\"No WebRTC support... \");\r\n            return;\r\n          }\r\n\r\n          const janus = new Janus({\r\n            server: server,\r\n            success: function () {\r\n              // Attach to echo test plugin\r\n              console.log(\"Janus loaded\");\r\n              setJanusInstance(janus);\r\n              dispatch(chatScrollLoadAction());\r\n              dispatch({ type: JANUS_CONNECT.SUCCESS, payload: { janusInstance: janus } });\r\n            },\r\n            error: function (error) {\r\n              Janus.error(error);\r\n              setJanusInstance(null);\r\n            },\r\n            destroyed: function () {\r\n              setJanusInstance(null);\r\n            },\r\n          });\r\n        },\r\n      });\r\n    }\r\n  }, [chatroom]);\r\n\r\n  useEffect(() => {\r\n    publishChatroom(\r\n      janusInstance,\r\n      opaqueId,\r\n      isPublisher,\r\n      chatroom,\r\n      username,\r\n      display,\r\n      (_chatroomHandler, eventType, data) => {\r\n        console.log(\"===== DATA RETURN =====\");\r\n        console.log(data);\r\n        console.log(eventType);\r\n        if (eventType === \"created\") {\r\n          console.log(\"==== created ====\");\r\n        } else if (eventType === \"joined\") {\r\n          console.log(\"==== joined ====\");\r\n          setChatroomHandler(_chatroomHandler);\r\n        } else if (eventType === \"ondata\") {\r\n          console.log(\"==== ondata ====\");\r\n          console.log(data);\r\n          if (data.from != username) {\r\n            dispatch({\r\n              type: CHAT_NEW_MESSAGE.SUCCESS,\r\n              payload: {\r\n                message: {\r\n                  room_id: data.room,\r\n                  from: data.from,\r\n                  text: data.data,\r\n                  time: data.date,\r\n                  partner_id: data.room.split(\"-\")[1],\r\n                  partner_user_id: data.room.split(\"-\")[2],\r\n                },\r\n              },\r\n            });\r\n          }\r\n        }\r\n      }\r\n    );\r\n\r\n    console.log(\"==== publishVideoCall ====\");\r\n    publishVideoCall(janusInstance, opaqueId, username, (_videocallHandler, result, _jsep) => {\r\n      console.log(\"==== DATA VIDEO CALL RETURN ====\");\r\n      console.log(result);\r\n      setJsep(_jsep);\r\n      const eventResult = result[\"event\"];\r\n      if (eventResult === \"registered\") {\r\n        _videocallHandler.send({ message: { request: \"list\" } });\r\n        setCallStatus(\"registered\");\r\n        setVideocallHandler(_videocallHandler);\r\n      } else if (eventResult === \"calling\") {\r\n        setCallStatus(\"calling\");\r\n      } else if (eventResult === \"incomingcall\") {\r\n        setCallModalVisible(true);\r\n        setCallStatus(\"incomingcall\");\r\n      } else if (eventResult === \"accepted\") {\r\n        setCallStatus(\"accepted\");\r\n        if (_jsep) _videocallHandler.handleRemoteJsep({ jsep: _jsep });\r\n      } else if (eventResult === \"update\") {\r\n      } else if (eventResult === \"hangup\") {\r\n        setCallModalVisible(false);\r\n      }\r\n    });\r\n  }, [janusInstance]);\r\n\r\n  const handleClickChatBox = () => {\r\n    if (chatTabVisible) {\r\n      setChatTabVisible(false);\r\n    } else {\r\n      setChatTabVisible(true);\r\n    }\r\n  };\r\n\r\n  const handleClickMinimizedIcon = () => {\r\n    setChatTabVisible(false);\r\n  };\r\n\r\n  const handleClickSeachBtn = () => {\r\n    if (searchBarVisible) {\r\n      setSearchBarVisible(false);\r\n    } else {\r\n      setSearchBarVisible(true);\r\n    }\r\n  };\r\n\r\n  const handleClickPhoneBtn = () => {\r\n    doCall(TO_CALL_PARTNER_USERNAME, videocallHandler);\r\n    setCallModalVisible(true);\r\n  };\r\n\r\n  const handleClickReplyBtn = (messContent) => {\r\n    setMessReplyContent(messContent);\r\n    setAddMsgReplyVisible(true);\r\n  };\r\n\r\n  const handleCancelAddMsgReply = () => {\r\n    setAddMsgReplyVisible(false);\r\n  };\r\n\r\n  const handleClickCancelBtn = () => {\r\n    console.log(\"handleClickCancelBtn\");\r\n    doHangup(videocallHandler);\r\n    setCallModalVisible(false);\r\n  };\r\n  const handleClickAcceptBtn = () => {\r\n    console.log(\"handleClickAcceptBtn\");\r\n    doAccept(videocallHandler, jsep);\r\n  };\r\n\r\n  return (\r\n    <div className=\"chat-widget\" style={{ right: position === \"right\" ? \"0\" : \"\" }}>\r\n      <div className=\"chat-widget__icon-wrap\">\r\n        <div className=\"chat-widget__icon\" onClick={handleClickChatBox}></div>\r\n      </div>\r\n      {chatTabVisible ? (\r\n        <ChatTab\r\n          handleClickPhoneBtn={handleClickPhoneBtn}\r\n          handleClickSeachBtn={handleClickSeachBtn}\r\n          handleClickMinimizedIcon={handleClickMinimizedIcon}\r\n          handleClickReplyBtn={handleClickReplyBtn}\r\n          handleCancelAddMsgReply={handleCancelAddMsgReply}\r\n          handleClickCancelBtn={handleClickCancelBtn}\r\n          handleClickAcceptBtn={handleClickAcceptBtn}\r\n          searchBarVisible={searchBarVisible}\r\n          addMsgReplyVisible={addMsgReplyVisible}\r\n          messReplyContent={messReplyContent}\r\n          position={position}\r\n          chatroomHandler={chatroomHandler}\r\n          callModalVisible={callModalVisible}\r\n        />\r\n      ) : (\r\n        \"\"\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ChatWidget;\r\n","import axios from \"../utils/request\";\r\n\r\nconst prefix = \"/api/v1/room\";\r\n\r\nexport const requireRoom = (data) => {\r\n  return axios({\r\n    method: \"POST\",\r\n    url: `${prefix}/requireRoom`,\r\n    data,\r\n  });\r\n};\r\n","// import { JANUS_PLUGIN } from \"../../configs\";\r\nimport Janus from \"./janus\";\r\n\r\nexport function publishVideoCall(janus, opaqueId, username, callback) {\r\n  let videocall;\r\n\r\n  if (!janus) {\r\n    return;\r\n  }\r\n\r\n  janus.attach({\r\n    plugin: \"janus.plugin.videocall\",\r\n    opaqueId: opaqueId,\r\n    success: function (pluginHandle) {\r\n      videocall = pluginHandle;\r\n      console.log(\"videocall success\");\r\n      let body = {\r\n        request: \"register\",\r\n        username,\r\n      };\r\n      videocall.send({ message: body });\r\n    },\r\n    error: function (error) {\r\n      console.log(\"  -- Error attaching plugin...\", error);\r\n    },\r\n    consentDialog: function (status) {\r\n      // Darken screen and show hint\r\n    },\r\n    mediaState: function (type, on) {\r\n      // detect change in media\r\n    },\r\n    onmessage: function (msg, jsep) {\r\n      console.log(\" ::: Got a message :::\", msg);\r\n      let result = msg[\"result\"];\r\n      if (result) {\r\n        if (result[\"list\"]) {\r\n          var list = result[\"list\"];\r\n          Janus.debug(\"Got a list of registered peers:\", list);\r\n          for (var mp in list) {\r\n            Janus.debug(\"  >> [\" + list[mp] + \"]\");\r\n          }\r\n        } else if (result[\"event\"]) {\r\n          callback(videocall, result, jsep);\r\n        }\r\n      }\r\n    },\r\n    onlocalstream: function (stream) {\r\n      Janus.attachMediaStream(document.querySelector(\"#localAudio\"), stream);\r\n      videocall.send({ message: { request: \"set\", audio: true } });\r\n    },\r\n    onremotestream: function (stream) {\r\n      Janus.attachMediaStream(document.querySelector(\"#remoteAudio\"), stream);\r\n      videocall.send({ message: { request: \"set\", audio: true } });\r\n    },\r\n  });\r\n}\r\n\r\nexport function doCall(username, videocallHandler) {\r\n  let doSimulcast = true;\r\n\r\n  // Call this user\r\n  videocallHandler.createOffer({\r\n    media: { data: true, video: false, audio: true },\r\n    simulcast: doSimulcast,\r\n    success: function (jsep) {\r\n      let body = { request: \"call\", username };\r\n      videocallHandler.send({ message: body, jsep: jsep });\r\n    },\r\n    error: function (error) {},\r\n  });\r\n}\r\n\r\nexport function doHangup(videocallHandler) {\r\n  console.log(\"88888 === doHangup\");\r\n  let hangup = { request: \"hangup\" };\r\n  videocallHandler.send({ message: hangup });\r\n  videocallHandler.hangup();\r\n}\r\n\r\nexport function doAccept(videocallHandler, jsep) {\r\n  console.log(\"88888 === doAccept\");\r\n  console.log(videocallHandler);\r\n  console.log(jsep);\r\n  let doSimulcast = false;\r\n\r\n  videocallHandler.createAnswer({\r\n    jsep,\r\n    media: { videoSend: false, audioSend: true },\r\n    simulcast: doSimulcast,\r\n    success: function (jsep) {\r\n      console.log(\"doaccept\");\r\n      console.log(jsep);\r\n      let body = { request: \"accept\" };\r\n      videocallHandler.send({ message: body, jsep: jsep });\r\n    },\r\n    error: function (error) {\r\n      console.log(\"error\");\r\n    },\r\n  });\r\n}\r\n","import React from \"react\";\r\nimport ChatWidget from \"./components/ChatWidget\";\r\nimport { USER_NAME, JANUS_SERVER, FROM_NAME } from \"./web.config\";\r\n\r\nfunction App(props) {\r\n  return (\r\n    <>\r\n      <ChatWidget\r\n        position=\"left\"\r\n        opaqueId=\"test4\"\r\n        username={USER_NAME}\r\n        server={JANUS_SERVER}\r\n        isPublisher={false}\r\n        display={FROM_NAME}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import { CHAT_NEW_MESSAGE, CHAT_SCROLLLOAD, REQUIRE_ROOM } from \"./types\";\r\nconst initialState = {\r\n  room: \"\",\r\n  listCount: 0,\r\n  list: [],\r\n  scrollLoadStatus: {},\r\n};\r\n\r\nfunction chatReducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case REQUIRE_ROOM.REQUEST:\r\n      return {\r\n        ...state,\r\n      };\r\n    case REQUIRE_ROOM.SUCCESS:\r\n      return {\r\n        ...state,\r\n        room: action.payload.room,\r\n      };\r\n    case REQUIRE_ROOM.ERROR:\r\n      return {\r\n        ...state,\r\n      };\r\n    case CHAT_NEW_MESSAGE.REQUEST:\r\n      return {\r\n        ...state,\r\n      };\r\n    case CHAT_NEW_MESSAGE.SUCCESS:\r\n      let { list } = state;\r\n      list.push(action.payload.message);\r\n      return {\r\n        ...state,\r\n        list,\r\n      };\r\n    case CHAT_NEW_MESSAGE.ERROR:\r\n      return {\r\n        ...state,\r\n      };\r\n    case CHAT_SCROLLLOAD.REQUEST:\r\n      return {\r\n        ...state,\r\n      };\r\n    case CHAT_SCROLLLOAD.SUCCESS:\r\n      return {\r\n        ...state,\r\n        listCount: action.payload.listCount,\r\n        list: action.payload.list.reverse(),\r\n        scrollLoadStatus: action.payload.scrollLoadStatus,\r\n      };\r\n    case CHAT_SCROLLLOAD.ERROR:\r\n      return {\r\n        ...state,\r\n      };\r\n    default:\r\n      return {\r\n        ...state,\r\n      };\r\n  }\r\n}\r\n\r\nexport default chatReducer;\r\n","import { JANUS_CONNECT } from \"./types\";\r\nconst initialState = {\r\n  isConnected: false,\r\n  janusInstance: null,\r\n};\r\n\r\nfunction janusReducer(state = initialState, action) {\r\n  switch (action.type) {\r\n    case JANUS_CONNECT.REQUEST:\r\n      return {\r\n        ...state,\r\n      };\r\n    case JANUS_CONNECT.SUCCESS:\r\n      return {\r\n        ...state,\r\n        isConnected: true,\r\n        janusInstance: action.payload.janusInstance,\r\n      };\r\n    case JANUS_CONNECT.ERROR:\r\n      return {\r\n        ...state,\r\n      };\r\n\r\n    default:\r\n      return {\r\n        ...state,\r\n      };\r\n  }\r\n}\r\n\r\nexport default janusReducer;\r\n","import { combineReducers } from \"redux\";\r\nimport chatReducer from \"./ChatWidget/reducer\";\r\nimport janusReducer from \"./Janus/reducer\";\r\n\r\nconst rootReducer = combineReducers({\r\n  chat: chatReducer,\r\n  janus: janusReducer,\r\n});\r\n\r\nexport default rootReducer;\r\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { applyMiddleware, compose, createStore } from \"redux\";\nimport thunk from \"redux-thunk\";\nimport App from \"./App\";\nimport \"./scss/style.scss\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport rootReducer from \"./reducer/index\";\n\nconst composeSetup = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\n\nconst store = createStore(rootReducer, composeSetup(applyMiddleware(thunk)));\n\nReactDOM.render( <\n    React.StrictMode >\n    <\n    Provider store = { store } >\n    <\n    App / >\n    <\n    /Provider> <\n    /React.StrictMode>,\n    document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();"],"sourceRoot":""}